<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="RALPH's Super-Intranet - Retro 90s Company Dashboard">
    <meta name="theme-color" content="#EB008B">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñ•Ô∏è</text></svg>")
    <title></title>
    <script>
        // Fallback CMS config if external file fails to load
        if (typeof CMS_CONFIG === 'undefined') {
            console.log('Loading fallback CMS config...');
        }
    </script>
    <script src="./cms-config.js" onerror="console.error('Failed to load cms-config.js')"></script>
    <script src="./api-integration.js" onerror="console.error('Failed to load api-integration.js')"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        :root {
            --ralph-pink: #EB008B;
            --ralph-pink-light: #ff1493;
            --terminal-green: #00ff00;
            --terminal-cyan: #00ffff;
            --terminal-yellow: #ffff00;
            --gray-light: #c0c0c0;
            --gray-dark: #808080;
            --window-bg: #c0c0c0;
            --black: #000000;
            --white: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: 'VT323', monospace;
            background: var(--ralph-pink);
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    rgba(255,255,255,.2) 0px,
                    transparent 1px,
                    transparent 2px,
                    rgba(255,255,255,.2) 3px
                );
            color: var(--black);
            cursor: auto;
            position: fixed;
            touch-action: manipulation;
        }
        
        .desktop {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .desktop-ascii {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 14px;
            line-height: 0.6;
            color: rgba(255, 255, 255, 0.3);
            white-space: pre;
            font-family: 'VT323', monospace;
            pointer-events: none;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
            z-index: 0;
            overflow: hidden;
            max-width: calc(100vw - 40px);
            opacity: 0;
        }
        
        .desktop-ascii.animating {
            opacity: 1;
        }
        
        .ascii-char {
            opacity: 0;
            transition: opacity 0.15s ease-in;
        }
        
        .ascii-char.visible {
            opacity: 1;
        }
        
        
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: var(--gray-light);
            border-top: 2px solid var(--white);
            display: flex;
            align-items: center;
            padding: 0 4px;
            z-index: 1000;
            box-shadow: inset -1px -1px var(--black), inset 1px 1px #dfdfdf;
        }
        
        .start-button {
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            padding: 4px 12px;
            font-family: 'VT323', monospace;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
        }
        
        .start-button:active {
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
        }

        .sound-button {
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            padding: 4px 8px;
            font-size: 16px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            color: var(--black);
            transition: all 0.1s;
            min-width: 40px;
            position: absolute;
            right: 90px;
            top: 50%;
            transform: translateY(-50%);
        }

        .sound-button:hover {
            background: var(--white);
        }

        .sound-button:active {
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
        }

        .sound-button.active {
            background: var(--ralph-pink);
            color: var(--white);
        }
        
        .ralph-logo {
            width: 16px;
            height: 16px;
            background: var(--ralph-pink);
            display: inline-block;
        }
        
        .clock {
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
            padding: 4px 8px;
            font-size: 18px;
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clock:hover {
            background: var(--white);
            border-color: var(--black) var(--gray-light) var(--gray-light) var(--black);
        }

        .timezone-panel {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-size: 16px;
        }

        .clock:hover .timezone-panel {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .timezone-header {
            background: var(--ralph-pink);
            color: var(--white);
            text-align: center;
            padding: 6px;
            border-bottom: 1px solid var(--gray-dark);
            font-weight: bold;
            text-shadow: 1px 1px 0 var(--black);
        }

        .timezone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            border-bottom: 1px solid var(--gray-dark);
            transition: background-color 0.2s ease;
        }

        .timezone-item:last-child {
            border-bottom: none;
        }

        .timezone-item:hover {
            background: var(--ralph-pink);
            color: var(--white);
        }

        .timezone-label {
            font-weight: bold;
        }

        .timezone-city {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .timezone-item:hover .timezone-city {
            color: rgba(255, 255, 255, 0.8);
        }

        .timezone-time {
            font-family: 'VT323', monospace;
            font-size: 16px;
            color: var(--black);
        }

        .timezone-item:hover .timezone-time {
            color: var(--white);
        }

        /* Iframe Window Styles */
        .iframe-window {
            position: absolute;
            background: var(--window-bg);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            min-width: 600px;
            min-height: 400px;
            z-index: 1000;
            display: none;
        }

        .iframe-window.active {
            display: block;
            z-index: 1001;
        }

        .iframe-header {
            background: var(--ralph-pink);
            color: var(--white);
            padding: 4px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            font-size: 16px;
            border-bottom: 1px solid var(--gray-dark);
        }

        .iframe-title {
            font-weight: bold;
            flex: 1;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .iframe-controls {
            display: flex;
            gap: 4px;
        }

        .iframe-control-btn {
            width: 20px;
            height: 20px;
            background: var(--gray-light);
            border: 1px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: var(--black);
        }

        .iframe-control-btn:hover {
            background: var(--white);
        }

        .iframe-control-btn:active {
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
        }

        .iframe-content {
            width: 100%;
            height: calc(100% - 29px);
            border: none;
            background: var(--white);
        }

        .iframe-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: var(--white);
            font-family: 'VT323', monospace;
            font-size: 18px;
            color: var(--ralph-pink);
        }

        /* Music Player Styles */
        .music-player {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 280px;
            height: 120px;
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            display: none;
            z-index: 1000;
            font-family: 'VT323', monospace;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .music-player.active {
            display: block;
        }
        
        .player-header {
            background: var(--ralph-pink);
            color: white;
            padding: 2px 8px;
            font-size: 14px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-dark);
        }
        
        .player-close {
            background: var(--gray-light);
            border: 1px solid var(--gray-dark);
            color: var(--black);
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }
        .player-close:hover {
            background: var(--white);
        }
        
        .volume-section {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            gap: 8px;
        }
        
        .volume-label {
            font-size: 12px;
            color: var(--black);
            font-family: 'VT323', monospace;
        }
        
        .volume-slider {
            width: 60px;
            height: 15px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray-dark);
            border: 1px solid var(--black);
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--ralph-pink);
            border: 1px solid var(--black);
            cursor: pointer;
        }
        
        .volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--ralph-pink);
            border: 1px solid var(--black);
            cursor: pointer;
            border-radius: 0;
        }


        .player-display {
            background: #0a0a0a;
            color: var(--terminal-green);
            padding: 4px 8px;
            font-size: 11px;
            height: 32px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-bottom: 1px solid #333;
        }

        .track-info {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .track-time {
            font-size: 10px;
            color: var(--terminal-cyan);
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            gap: 4px;
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
        }

        .control-btn {
            width: 24px;
            height: 20px;
            background: var(--gray-light);
            border: 1px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-family: 'VT323', monospace;
        }

        .control-btn:hover {
            background: var(--white);
        }

        .control-btn:active {
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
        }

        .control-btn.play {
            background: var(--ralph-pink);
            color: var(--white);
            width: 32px;
        }

        .volume-section {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            background: #2a2a2a;
            border-top: 1px solid #333;
            gap: 4px;
        }

        .volume-label {
            color: var(--gray-light);
            font-size: 10px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: #0a0a0a;
            border: 1px inset #333;
            position: relative;
        }

        .volume-fill {
            height: 100%;
            background: var(--ralph-pink);
            width: 70%;
            transition: width 0.1s;
        }

        .playlist-btn {
            background: var(--gray-dark);
            border: 1px solid #555;
            color: var(--white);
            padding: 2px 6px;
            cursor: pointer;
            font-size: 10px;
        }
        
        .desktop-icons {
            position: absolute;
            right: 20px;
            top: 20px;
            display: grid;
            grid-template-columns: repeat(2, 100px);
            grid-auto-rows: 100px;
            gap: 20px;
            height: calc(100vh - 80px);
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            text-align: center;
            padding: 8px;
            border: 2px solid transparent;
            touch-action: manipulation;
        }
        
        .icon:hover, .icon:active {
            background: rgba(235, 0, 139, 0.2);
            border: 2px dotted var(--ralph-pink);
        }
        
        .icon-image {
            width: 48px;
            height: 48px;
            margin-bottom: 4px;
            position: relative;
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .icon-label {
            font-size: 14px;
            color: var(--white);
            text-shadow: 1px 1px 0 var(--black);
            word-break: break-word;
            line-height: 1.2;
        }
        
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 2px solid;
            border-color: var(--white) var(--black) var(--black) var(--white);
            box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
            display: none;
            min-width: 300px;
            min-height: 200px;
            max-width: 90vw;
            max-height: 85vh;
        }
        
        .window.active {
            display: block;
        }
        
        .window-header {
            background: linear-gradient(90deg, #000080, var(--ralph-pink));
            color: white;
            padding: 3px;
            display: flex;
            align-items: center;
            font-size: 16px;
            cursor: move;
            touch-action: none;
        }
        
        .window-title {
            flex: 1;
            padding: 0 8px;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-button {
            width: 20px;
            height: 20px;
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--black) var(--black) var(--white);
            font-family: 'VT323', monospace;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .window-button:active {
            border-color: var(--black) var(--white) var(--white) var(--black);
        }
        
        .window-content {
            padding: 12px;
            background: var(--white);
            margin: 4px;
            border: 2px solid;
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
            height: calc(100% - 40px);
            overflow-y: auto;
            overflow-x: hidden;
            font-size: 18px;
        }
        
        /* Pipeline Layout Styles */
        .pipeline-container {
            display: flex;
            height: 100%;
            min-width: 800px;
            padding: 15px;
            gap: 2px;
            background: var(--gray-dark);
        }
        
        .pipeline-column {
            flex: 1;
            min-width: 180px;
            display: flex;
            flex-direction: column;
            border: 2px inset var(--gray-light);
            background: var(--window-bg);
        }
        
        .pipeline-header {
            padding: 8px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            letter-spacing: 0.5px;
            border-bottom: 2px inset var(--gray-dark);
        }
        
        .pipeline-header h3 {
            margin: 0;
            color: var(--black);
        }
        
        .pipeline-header .count {
            color: var(--gray-dark);
            font-weight: normal;
        }
        
        .pipeline-items {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
        }
        
        .pipeline-item {
            background: var(--white);
            border: 1px outset var(--gray-light);
            margin-bottom: 8px;
            padding: 8px;
            font-size: 11px;
            line-height: 1.3;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pipeline-item:hover {
            border: 1px inset var(--gray-dark);
            background: #f5f5f5;
        }
        
        .pipeline-item .client-name {
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--black);
        }
        
        .pipeline-item .due-date {
            color: var(--gray-dark);
            font-size: 10px;
            margin-bottom: 4px;
        }
        
        .pipeline-item .office {
            display: inline-block;
            background: var(--gray-dark);
            color: var(--white);
            padding: 1px 4px;
            font-size: 9px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .pipeline-item .links {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }
        
        .pipeline-item .link-btn {
            background: var(--ralph-pink);
            color: var(--white);
            border: 1px outset var(--ralph-pink);
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .pipeline-item .link-btn:hover {
            border: 1px inset var(--ralph-pink);
        }
        
        /* Column-specific colors */
        .warm-leads .pipeline-header { background: #ff6b6b; color: white; }
        .pitches-happening .pipeline-header { background: #ff9f43; color: white; }
        .pitch-submitted .pipeline-header { background: #feca57; color: black; }
        .pitch-presented .pipeline-header { background: #48ca9c; color: white; }
        .pitch-won .pipeline-header { background: #54a0ff; color: white; }
        
        .module-item {
            background: #f0f0f0;
            border: 2px solid;
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
            padding: 8px;
            margin-bottom: 8px;
        }
        
        .module-item h3 {
            color: var(--ralph-pink);
            font-size: 20px;
            margin-bottom: 8px;
            border-bottom: 2px dotted var(--ralph-pink);
            padding-bottom: 4px;
        }
        
        .progress-bar {
            background: var(--gray-dark);
            border: 2px solid;
            border-color: var(--black) var(--white) var(--white) var(--black);
            height: 20px;
            position: relative;
            margin: 8px 0;
        }
        
        .progress-fill {
            background: repeating-linear-gradient(
                90deg,
                var(--ralph-pink),
                var(--ralph-pink) 10px,
                var(--ralph-pink-light) 10px,
                var(--ralph-pink-light) 20px
            );
            height: 100%;
            transition: width 0.3s;
        }
        
        .pixel-button {
            background: var(--gray-light);
            border: 2px solid;
            border-color: var(--white) var(--gray-dark) var(--gray-dark) var(--white);
            padding: 8px 16px;
            font-family: 'VT323', monospace;
            font-size: 18px;
            cursor: pointer;
            margin: 4px;
            touch-action: manipulation;
        }
        
        .pixel-button:hover, .pixel-button:active {
            background: var(--ralph-pink);
            color: white;
        }
        
        .pixel-button:active {
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .ascii-art {
            font-size: 12px;
            line-height: 1;
            color: var(--ralph-pink);
            white-space: pre;
            margin: 8px 0;
        }
        
        input[type="text"], textarea {
            background: var(--white);
            border: 2px solid;
            border-color: var(--gray-dark) var(--white) var(--white) var(--gray-dark);
            padding: 4px;
            font-family: 'VT323', monospace;
            font-size: 18px;
            width: 100%;
            margin: 4px 0;
        }
        
        .scanlines::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 0, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
        }
        
        .crt-flicker {
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.97; }
            50% { opacity: 1; }
            100% { opacity: 0.98; }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--terminal-yellow);
            border: 2px solid var(--black);
            padding: 12px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.5);
            font-size: 18px;
            z-index: 9998;
            display: none;
            max-width: 300px;
        }
        
        .notification.show {
            display: block;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--black);
            color: var(--terminal-green);
            font-family: 'VT323', monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
            padding: 20px;
        }
        
        .boot-screen.hide {
            opacity: 0;
            pointer-events: none;
        }
        
        .boot-logo {
            font-size: 10px;
            line-height: 0.56;
            color: var(--ralph-pink);
            white-space: pre;
            margin-bottom: 40px;
            text-shadow: 0 0 10px var(--ralph-pink);
            overflow: hidden;
            max-width: 100%;
            opacity: 1;
        }
        
        
        .boot-text {
            color: var(--terminal-green);
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .loading-bar-container {
            width: 90%;
            max-width: 400px;
            height: 30px;
            border: 2px solid var(--terminal-green);
            background: var(--black);
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }
        
        .loading-bar {
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                var(--ralph-pink),
                var(--ralph-pink) 10px,
                var(--ralph-pink-light) 10px,
                var(--ralph-pink-light) 20px
            );
            width: 0%;
            transition: width 0.3s;
        }
        
        .loading-percentage {
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--terminal-green);
            font-size: 18px;
        }
        
        .boot-messages {
            margin-top: 30px;
            height: 100px;
            overflow: hidden;
            font-size: 14px;
            color: var(--terminal-green);
            text-align: left;
            width: 90%;
            max-width: 500px;
        }
        
        .boot-message {
            margin: 2px 0;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* Mobile Responsive Styles */
        @media screen and (max-width: 768px) {
            body {
                overflow-y: auto;
                overflow-x: hidden;
                position: relative;
            }
            
            .desktop {
                min-height: 100vh;
                height: auto;
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .desktop-ascii {
                font-size: 8px;
                line-height: 0.54;
                top: 10px;
                left: 10px;
            }
            
            .desktop-icons {
                position: relative;
                right: auto;
                top: auto;
                padding: 120px 20px 60px 20px;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                grid-auto-rows: 90px;
                gap: 10px;
                height: auto;
                width: 100%;
                overflow: visible;
            }
            
            .icon {
                padding: 4px;
            }
            
            .icon-image {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .icon-label {
                font-size: 12px;
            }
            
            .window {
                position: fixed !important;
                top: 10px !important;
                left: 10px !important;
                right: 10px !important;
                bottom: 50px !important;
                width: auto !important;
                height: auto !important;
                max-width: none;
                max-height: none;
                z-index: 900;
            }
            
            .window-header {
                touch-action: none;
                padding: 5px;
            }
            
            .window-title {
                font-size: 14px;
            }
            
            .window-button {
                width: 30px;
                height: 30px;
                font-size: 18px;
            }
            
            .window-content {
                font-size: 16px;
                padding: 8px;
            }
            
            .module-item h3 {
                font-size: 18px;
            }
            
            .pixel-button {
                font-size: 16px;
                padding: 10px 12px;
            }
            
            .notification {
                right: 10px;
                top: 10px;
                font-size: 14px;
                max-width: calc(100vw - 40px);
            }
            
            .boot-logo {
                font-size: 5px;
                line-height: 0.7;
            }
            
            .boot-text {
                font-size: 14px;
            }
            
            .loading-percentage {
                right: -40px;
                font-size: 14px;
            }
            
            .boot-messages {
                font-size: 12px;
            }
            
            input[type="text"], textarea {
                font-size: 16px;
                padding: 8px;
            }
            
            /* Hide scanlines on mobile for performance */
            .scanlines::before {
                display: none;
            }
            
            /* Simplify animations on mobile */
            .crt-flicker {
                animation: none;
            }
        }
        
        /* Small mobile devices */
        @media screen and (max-width: 480px) {
            .desktop-ascii {
                font-size: 6px;
                line-height: 0.48;
            }
            
            .desktop-icons {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                grid-auto-rows: 80px;
                padding: 100px 10px 60px 10px;
            }
            
            .icon-image {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
            
            .icon-label {
                font-size: 11px;
            }
            
            .boot-logo {
                font-size: 4px;
                line-height: 0.49;
            }
        }
        
        /* Landscape mobile */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .desktop-icons {
                padding: 80px 20px 60px 20px;
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                grid-auto-rows: 70px;
            }
            
            .desktop-ascii {
                font-size: 6px;
                line-height: 0.36;
            }
            
            .window {
                top: 5px !important;
                bottom: 45px !important;
            }
        }
        
        /* Banner popup styles - 8-bit style */
        .banner-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 480px;
            max-width: 90vw;
            background: 
                repeating-linear-gradient(
                    0deg,
                    #ff00ff 0px,
                    #ff00ff 4px,
                    #00ffff 4px,
                    #00ffff 8px,
                    #ffff00 8px,
                    #ffff00 12px,
                    #ff0000 12px,
                    #ff0000 16px
                );
            border: 4px solid var(--black);
            box-shadow: 
                0 0 0 2px var(--white),
                0 0 0 6px var(--black),
                8px 8px 0 var(--black);
            z-index: 9999;
            font-family: 'VT323', monospace;
            animation: pixelBounce 0.6s steps(4, end);
            display: none;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .banner-popup.show {
            display: block;
        }
        
        @keyframes pixelBounce {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            25% {
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            75% {
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .banner-header {
            background: 
                repeating-linear-gradient(
                    90deg,
                    var(--black) 0px,
                    var(--black) 2px,
                    var(--ralph-pink) 2px,
                    var(--ralph-pink) 4px
                );
            color: var(--white);
            padding: 12px 16px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 0 var(--black);
            position: relative;
            border-bottom: 4px solid var(--black);
        }
        
        .banner-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--terminal-green);
            animation: scanline 1s linear infinite;
        }
        
        @keyframes scanline {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .banner-content {
            padding: 20px;
            background: var(--white);
            color: var(--black);
            font-size: 16px;
            line-height: 1.2;
            text-align: center;
            border: 2px inset var(--gray-light);
        }
        
        .banner-text {
            margin-bottom: 16px;
            font-weight: bold;
            text-shadow: 1px 1px 0 var(--gray-light);
        }
        
        .banner-highlight {
            color: var(--ralph-pink);
            font-weight: bold;
            text-shadow: 1px 1px 0 var(--black);
            background: var(--terminal-yellow);
            padding: 2px 4px;
            border: 1px solid var(--black);
        }
        
        .banner-close {
            background: var(--ralph-pink);
            color: var(--white);
            border: 4px outset var(--ralph-pink);
            padding: 12px 20px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-shadow: 1px 1px 0 var(--black);
            box-shadow: 4px 4px 0 var(--black);
            transition: none;
        }
        
        .banner-close:hover {
            background: var(--terminal-green);
            border-color: var(--terminal-green);
        }
        
        .banner-close:active {
            border: 4px inset var(--ralph-pink);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--black);
        }
        
        /* Mobile banner adjustments */
        @media screen and (max-width: 600px) {
            .banner-popup {
                width: 300px;
                font-size: 12px;
            }
            
            .banner-header {
                font-size: 14px;
                padding: 8px 12px;
            }
            
            .banner-content {
                padding: 16px;
                font-size: 14px;
            }
            
            .banner-close {
                padding: 8px 16px;
                font-size: 14px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .icon:hover {
                background: transparent;
                border-color: transparent;
            }
            
            .pixel-button:hover {
                background: var(--gray-light);
                color: inherit;
            }
        }
    </style>
</head>
<body>
    <div class="boot-screen" id="bootScreen">
        <div class="boot-logo" id="bootLogo">
############################################################################################################################## 
############################################################################################################################## 
############################################################################################################################## 
########################################################      ################################################################ 
######################################################  #####   ############################################################## 
##################################################### #########  ############################################################# 
#################################################### #### # #### ############################################################# 
#################################################### ### ####### ############################################################# 
################################################### #### ### ###  ############################################################ 
################################################### #### ### ###  ############################################################ 
################################################### #### ### ###  ############################################################ 
################################################### #### ### ### ############################################################# 
################################################### ### #### ### #####################################  ###################### 
################################################### ### #### ### #####################################    #################### 
################################################### ### #### ### ##################################### ## #################### 
################################################### ### ###  ### ##################################### ### ################### 
################################################### ### ### #### ##################################### ### ################### 
################################################### ### ### ### ###################################### ### ################### 
################################################### ### ### ### ###################################### ### ################### 
################################################### ###  ## ### ###################################### ### ################### 
################################################### #### ## ### ###################################### ### ################### 
###################        ######################## #### ## ## ####################################### ### ################### 
#################      ############################ #### ## ## ########   ########         ########### ### ################### 
###############  ##  ##############     ############ ### ##### ######## #   ####  ##    ##  ######### #### ################### 
#############  ##  ###########            ########## ### # ### ######## ### ###  #  #### ### ######## ### #################### 
############  ##  ##########      ################## ######## ######## #### ##  # ###### #### ####### ### ######### ########## 
#      #### ###  #########  ##  ########  ########## ######## ######## #### #  # ####### #### ###### #### ####          ###### 
## #### ## #### ######### ### ########  # ########### ####### ######## ###### # ######## #### ###### ###  ###  ##   ###  ##### 
### ####  #### #########  ## ######### ##  ########## ###### ######### ######## ######## #### ##### #### ##  ##  ## ####  #### 
### ######### ########## ### ######### ### ########## ###### ######### ####### ######### #### ##### ######  #  ##### ### ##### 
#### ######## ########## ### ######### ### ########## ##### ########## ####### ######## ##### ####  ##### ##  ###### ### ##### 
####  ####### ########## ### ######### #### ######### ##### ########## ###### ######### #### ##### ########  ###### ### ###### 
##### ####### ########## ### ######### ####  ######## ##### ######### ####### ######## ####  ##### ####### ####### #### ###### 
###### ################# ### ######## ######  ######  ###### #######  ####### ####### ####  ##### ####### #######  ### ####### 
###### ###### ##########  ### ######  ##   ###  ###  ########   #    ########  ##### ####  ###### ###### ######## #### ####### 
####### ##### ########### ####       ## ##   ###  ####    #####################     ###  ####### ###### ######## #### ######## 
#######  #### ############ ###########  ####   #####   ##   ######   #####    ######   ######### #####  ######## #### ######## 
######## #### #############  #######   ########      ######       ### ### ###        ##########  ####  ######### #### ######## 
######### ###  ##############        ################################ ### #####################  #### ########## #### ######## 
######### #### ###################################################### ### ######################      ########## ####  ####### 
########## #### #################################################### #### #########################  ############  ### ####### 
##########  ###  ################################################### #### ########################################   ##  ##### 
###########  ### ################################################### #### ##########################################      #### 
#############     ################################################## #### #############################################    ### 
#################################################################### #### #################################################### 
################################################################### #### ##################################################### 
################################################################### #### ##################################################### 
################################################################### #### ##################################################### 
################################################################### #### ##################################################### 
################################################################### #### ##################################################### 
##################################################################  #### ##################################################### 
##################################################################  #### ##################################################### 
###################################################################   #  ##################################################### 
#####################################################################   ###################################################### 
############################################################################################################################## 
##############################################################################################################################
        </div>
        <div class="boot-text">INITIALIZING SUPER-INTRANET SYSTEM v1.0</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loadingBar"></div>
            <div class="loading-percentage" id="loadingPercentage">0%</div>
        </div>
        <div class="boot-messages" id="bootMessages"></div>
    </div>
    
    <div class="desktop scanlines crt-flicker" style="display: none;" id="desktop">
        <div class="desktop-ascii" id="desktopAscii">
############################################################################################                       
############################################################################################                       
############################################################################################                       
########################################      ##############################################                       
#######################################         ############################################                       
######################################          ############################################                       
######################################    ##    ############################################                       
#####################################     ##    ############################################                       
#####################################     ##    ############################################                       
#####################################     ##    ############################################                       
#####################################     ##    ##########################   ###############                       
#####################################     ##    ##########################    ##############                       
#####################################     #     ##########################    ##############                       
#####################################     #     ##########################    ##############                       
#####################################     #    ###########################    ##############                       
#####################################     #    ###########################    ##############                       
##############      #################     #    ###############  ##########    ##############                       
############     ####################     #    ####    ####        #######    ##############                       
##########     #######         #######    #   #####     ##    #     #####     ############## #####   ##########    
##   ####     ######     #############        ### #     #   ####     ####     ####    ###### ##  #   ##########    
##    ##     ######    #####    ######        ### #        #####     ####    ##         #### #####   ####          
##          ######    ######    ######       #### #        #####     ###     #           ### #####   ##########    
###        #######    ######    #######      ######       ######     ###         ###     ###             #######   
###        ######     ######     ######     #######       #####     ###         ###     ####                ####   
####       #######    ######     ######      #####       ## ##      ###       #####    #####         ##########    
#####      #######    #####        ###        ###         ####     ####      #####     #####         #             
#####      #######            #                                   ####       #####    ######                       
######     ########           ##        ##                      ######      #####     ######                       
######     #########        #######   ######    ##     ###   ########      ######     ######                       
#######     ############ #########################     ###############     ######      #####                       
########     #####################################     #################  ########     #####                       
########     ####################################     ##############################     ###                       
##########    ###################################     #################################   ##                       
#################################################     ######################################                       
#################################################     ######################################                       
#################################################     ######################################                       
################################################      ######################################                       
################################################      ######################################                       
################################################     #######################################                       
##################################################   #######################################                       
############################################################################################                       
############################################################################################                       
                                                                                                                     
                                                                                                                     
 ####  ##  #  ##### #####  ####      ##### ##  ## ###### #####   ###   ##  #  ###########                          
##     ##  #  ## ##  #     #  #   ##   #   ######   ##   #  ##  #  ##  #####  ##      #                            
   ##  ##  #  ####   #     #####  ##   #   ## ###   ##   #####  #####  #  ##  ##     ##                            
#####  #####  ##     ####  #   #     ##### ##  ##   ##   #   #  #   #  #   #  #####   #                            

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                  [ SYSTEM v1.0 ONLINE ]
        </div>
        <div class="desktop-icons" id="desktop-icons">
            <!-- Desktop icons will be loaded dynamically from CMS configuration -->
            <div class="icon" onclick="openAdminLogin()">
                <div class="icon-image">‚öôÔ∏è</div>
                <div class="icon-label">Intranet Admin</div>
            </div>
        </div>
        
        <!-- Windows -->
        <div id="chatbot" class="window active" style="bottom: 60px; left: 45%; top: auto; width: 450px; height: 400px;">
            <div class="window-header">
                <div class="window-title">üí¨ RALPH Assistant v1.0</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('chatbot')">_</button>
                    <button class="window-button" onclick="maximizeWindow('chatbot')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('chatbot')">X</button>
                </div>
            </div>
            <div class="window-content" style="display: flex; flex-direction: column; padding: 8px;">
                <div id="chatDisplay" style="flex: 1; background: #000; color: #00ff00; padding: 10px; font-family: 'VT323', monospace; font-size: 16px; overflow-y: auto; margin-bottom: 8px; border: 2px solid; border-color: #808080 #ffffff #ffffff #808080;">
                    <div style="color: #EB008B;">=======================================</div>
                    <div style="color: #EB008B;">RALPH ASSISTANT v1.0 - INITIALIZED</div>
                    <div style="color: #EB008B;">=======================================</div>
                    <div style="margin-top: 10px;">
                        <span style="color: #ffff00;">ASSISTANT:</span> Welcome to RALPH's Super-Intranet!
                    </div>
                    <div style="margin-top: 10px;">
                        Here's what you can do:
                    </div>
                    <div style="margin-top: 10px; color: #00ffff;">
                        ‚ñ∫ Click any desktop icon to open modules<br>
                        ‚ñ∫ Drag windows by their title bars<br>
                        ‚ñ∫ Minimize, maximize, or close windows<br>
                        ‚ñ∫ Submit suggestions in the Suggestion Box<br>
                        ‚ñ∫ Accept challenges<br>
                        ‚ñ∫ Check project pipelines and deadlines<br>
                        ‚ñ∫ Send shoutouts to team members
                    </div>
                    <div style="margin-top: 10px;">
                        <span style="color: #ffff00;">TIP:</span> Press ESC to close all windows
                    </div>
                    <div style="margin-top: 10px;">
                        Type 'help' for more commands or ask me anything!
                    </div>
                    <div style="margin-top: 10px; color: #00ff00;" class="blink">
                        > _
                    </div>
                </div>
                <div style="display: flex; gap: 4px;">
                    <input type="text" id="chatInput" placeholder="Type your message here..." style="flex: 1; background: #000; color: #00ff00; border: 2px solid #00ff00; font-family: 'VT323', monospace; font-size: 16px; padding: 6px;">
                    <button class="pixel-button" onclick="sendChat()" style="margin: 0; padding: 6px 12px;">SEND</button>
                </div>
            </div>
        </div>
        
        <div id="newBiz" class="window" style="top: 50px; left: 50px;">
            <div class="window-header">
                <div class="window-title">üìä New Business Pipeline v2.0</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('newBiz')">_</button>
                    <button class="window-button" onclick="maximizeWindow('newBiz')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('newBiz')">X</button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow-x: auto;">
                <div class="pipeline-container">
                    <div class="pipeline-column warm-leads">
                        <div class="pipeline-header">
                            <h3>WARM LEADS <span class="count">(0)</span></h3>
                        </div>
                        <div class="pipeline-items" id="warmLeads">
                            <!-- Items will be populated by loadContentFromCMS -->
                        </div>
                    </div>
                    <div class="pipeline-column pitches-happening">
                        <div class="pipeline-header">
                            <h3>PITCHES HAPPENING <span class="count">(0)</span></h3>
                        </div>
                        <div class="pipeline-items" id="pitchesHappening">
                            <!-- Items will be populated by loadContentFromCMS -->
                        </div>
                    </div>
                    <div class="pipeline-column pitch-submitted">
                        <div class="pipeline-header">
                            <h3>PITCH SUBMITTED <span class="count">(0)</span></h3>
                        </div>
                        <div class="pipeline-items" id="pitchSubmitted">
                            <!-- Items will be populated by loadContentFromCMS -->
                        </div>
                    </div>
                    <div class="pipeline-column pitch-presented">
                        <div class="pipeline-header">
                            <h3>PITCH PRESENTED <span class="count">(0)</span></h3>
                        </div>
                        <div class="pipeline-items" id="pitchPresented">
                            <!-- Items will be populated by loadContentFromCMS -->
                        </div>
                    </div>
                    <div class="pipeline-column pitch-won">
                        <div class="pipeline-header">
                            <h3>PITCH WON <span class="count">(0)</span></h3>
                        </div>
                        <div class="pipeline-items" id="pitchWon">
                            <!-- Items will be populated by loadContentFromCMS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="premieres" class="window" style="top: 100px; left: 100px;">
            <div class="window-header">
                <div class="window-title">üé¨ Project Premiere Calendar</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('premieres')">_</button>
                    <button class="window-button" onclick="maximizeWindow('premieres')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('premieres')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>THIS MONTH</h3>
                    <p>üìÖ Dec 15 - "Urban Dreams" Documentary</p>
                    <p>üìÖ Dec 20 - Holiday Campaign Launch</p>
                    <p>üìÖ Dec 28 - Year-End Showcase</p>
                </div>
                <div class="module-item">
                    <h3>JANUARY 2025</h3>
                    <p>üìÖ Jan 10 - New Product Launch Film</p>
                    <p>üìÖ Jan 15 - Brand Refresh Campaign</p>
                    <p>üìÖ Jan 25 - Super Bowl Teaser</p>
                </div>
            </div>
        </div>
        
        <div id="challenge" class="window" style="top: 150px; left: 150px;">
            <div class="window-header">
                <div class="window-title">üé® Challenges</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('challenge')">_</button>
                    <button class="window-button" onclick="maximizeWindow('challenge')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('challenge')">X</button>
                </div>
            </div>
            <div class="window-content" id="challenge-content">
                <!-- Navigation state will be managed here -->
            </div>
        </div>
        
        <div id="shoutouts" class="window" style="top: 50px; left: 200px;">
            <div class="window-header">
                <div class="window-title">üéâ Shoutouts & Celebrations</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('shoutouts')">_</button>
                    <button class="window-button" onclick="maximizeWindow('shoutouts')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('shoutouts')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>BIRTHDAYS THIS MONTH üéÇ</h3>
                    <p class="blink">‚ñ∫ Today - Mike R. from Production!</p>
                    <p>‚ñ∫ Dec 18 - Jennifer L. from Creative</p>
                    <p>‚ñ∫ Dec 22 - Alex T. from Strategy</p>
                </div>
                <div class="module-item">
                    <h3>WORK ANNIVERSARIES üéä</h3>
                    <p>‚≠ê 5 Years - David K.</p>
                    <p>‚≠ê 3 Years - Lisa M.</p>
                    <p>‚≠ê 1 Year - Team Expansion Crew!</p>
                </div>
                <div class="module-item">
                    <h3>SHOUTOUTS üì¢</h3>
                    <p>"Huge thanks to the edit team for crushing it on the Tech Corp project!" - Management</p>
                    <p>"Props to IT for the smooth system upgrade!" - Everyone</p>
                    <button class="pixel-button" onclick="showNotification('Shoutout sent!')">SEND SHOUTOUT</button>
                </div>
            </div>
        </div>
        
        <div id="articles" class="window" style="top: 100px; left: 250px;">
            <div class="window-header">
                <div class="window-title">üì∞ Industry Articles</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('articles')">_</button>
                    <button class="window-button" onclick="maximizeWindow('articles')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('articles')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>TRENDING NOW</h3>
                    <p>üìñ "The Rise of AI in Creative Production"</p>
                    <p>üìñ "2025 Design Trends to Watch"</p>
                    <p>üìñ "Sustainable Filmmaking Practices"</p>
                    <button class="pixel-button">READ MORE</button>
                </div>
                <div class="module-item">
                    <h3>MUST READS</h3>
                    <p>üìö AdWeek: "Agencies of the Future"</p>
                    <p>üìö Campaign: "Digital First Strategies"</p>
                    <p>üìö Creative Review: "Best Campaigns 2024"</p>
                </div>
            </div>
        </div>
        
        <div id="ralphNews" class="window" style="top: 150px; left: 300px;">
            <div class="window-header">
                <div class="window-title">üì¢ RALPH News Network</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('ralphNews')">_</button>
                    <button class="window-button" onclick="maximizeWindow('ralphNews')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('ralphNews')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="ascii-art">
    ‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñà‚ñë‚ñë‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñà‚ñë‚ñà
    ‚ñë‚ñà‚ñÄ‚ñÑ‚ñë‚ñà‚ñÄ‚ñà‚ñë‚ñà‚ñë‚ñë‚ñë‚ñà‚ñÄ‚ñÄ‚ñë‚ñà‚ñÄ‚ñà
    ‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñë‚ñë‚ñë‚ñÄ‚ñë‚ñÄ
                </div>
                <div class="module-item">
                    <h3>BREAKING NEWS</h3>
                    <p class="blink">üî¥ LIVE: New Office Space Opening Q1 2025!</p>
                    <p>‚Ä¢ Award Win: Best Campaign at Industry Awards</p>
                    <p>‚Ä¢ Client Win: Major Automotive Account</p>
                </div>
                <div class="module-item">
                    <h3>COMPANY UPDATES</h3>
                    <p>‚úì New Equipment in Studio B</p>
                    <p>‚úì Holiday Party December 20th</p>
                    <p>‚úì Q4 Numbers Looking Strong!</p>
                </div>
            </div>
        </div>
        
        <div id="suggestions" class="window" style="top: 50px; left: 350px;">
            <div class="window-header">
                <div class="window-title">üí≠ Digital Suggestion Box</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('suggestions')">_</button>
                    <button class="window-button" onclick="maximizeWindow('suggestions')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('suggestions')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>SUBMIT YOUR IDEA</h3>
                    <input type="text" placeholder="Your Name...">
                    <textarea rows="4" placeholder="Your brilliant idea here..."></textarea>
                    <button class="pixel-button" onclick="submitSuggestion()">SUBMIT</button>
                </div>
                <div class="module-item">
                    <h3>RECENT SUGGESTIONS</h3>
                    <p>üí° "Coffee machine upgrade" - Status: APPROVED ‚úì</p>
                    <p>üí° "Flexible Friday hours" - Status: IN REVIEW</p>
                    <p>üí° "Pet-friendly office days" - Status: CONSIDERING</p>
                </div>
            </div>
        </div>
        
        <div id="announcements" class="window" style="top: 100px; left: 400px;">
            <div class="window-header">
                <div class="window-title">üì£ System Announcements</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('announcements')">_</button>
                    <button class="window-button" onclick="maximizeWindow('announcements')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('announcements')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3 class="blink">‚ö†Ô∏è IMPORTANT ‚ö†Ô∏è</h3>
                    <p>System maintenance scheduled for Saturday 2:00 AM</p>
                    <p>Please save all work before Friday EOD</p>
                </div>
                <div class="module-item">
                    <h3>GENERAL ANNOUNCEMENTS</h3>
                    <p>üìå Parking lot B closed for repairs this week</p>
                    <p>üìå New health benefits info session Thursday</p>
                    <p>üìå Kitchen renovation complete - enjoy!</p>
                </div>
            </div>
        </div>
        
        <div id="links" class="window" style="top: 150px; left: 450px;">
            <div class="window-header">
                <div class="window-title">üîó Quick Links Directory</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('links')">_</button>
                    <button class="window-button" onclick="maximizeWindow('links')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('links')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>INTERNAL TOOLS</h3>
                    <button class="pixel-button">TIMESHEET SYSTEM</button>
                    <button class="pixel-button">PROJECT TRACKER</button>
                    <button class="pixel-button">EXPENSE REPORTS</button>
                    <button class="pixel-button">IT HELPDESK</button>
                </div>
                <div class="module-item">
                    <h3>EXTERNAL RESOURCES</h3>
                    <button class="pixel-button">CLIENT PORTAL</button>
                    <button class="pixel-button">VENDOR DATABASE</button>
                    <button class="pixel-button">STOCK FOOTAGE</button>
                </div>
            </div>
        </div>
        
        <div id="innovation" class="window" style="top: 50px; left: 500px;">
            <div class="window-header">
                <div class="window-title">üí° Innovation Lab Updates</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('innovation')">_</button>
                    <button class="window-button" onclick="maximizeWindow('innovation')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('innovation')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>CURRENT EXPERIMENTS</h3>
                    <p>üî¨ VR Production Pipeline - Phase 2</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%;"></div>
                    </div>
                    <p>üî¨ AI-Assisted Editing Tools</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 40%;"></div>
                    </div>
                    <p>üî¨ Real-time Rendering System</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 80%;"></div>
                    </div>
                </div>
                <div class="module-item">
                    <h3>INNOVATION FRIDAYS</h3>
                    <p>Next Session: "Future of Motion Graphics"</p>
                    <p>Speaker: Guest from Pixar</p>
                    <button class="pixel-button" onclick="showNotification('RSVP Confirmed!')">RSVP</button>
                </div>
            </div>
        </div>
        
        <div id="resources" class="window" style="top: 100px; left: 550px;">
            <div class="window-header">
                <div class="window-title">üìÅ Resource Center</div>
                <div class="window-controls">
                    <button class="window-button" onclick="minimizeWindow('resources')">_</button>
                    <button class="window-button" onclick="maximizeWindow('resources')">‚ñ°</button>
                    <button class="window-button" onclick="closeWindow('resources')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="module-item">
                    <h3>DOCUMENTS</h3>
                    <p>üìÑ Brand Guidelines v3.2</p>
                    <p>üìÑ Employee Handbook 2024</p>
                    <p>üìÑ Creative Best Practices</p>
                    <p>üìÑ Client Onboarding Guide</p>
                    <button class="pixel-button">DOWNLOAD ALL</button>
                </div>
                <div class="module-item">
                    <h3>TEMPLATES</h3>
                    <p>üìã Presentation Template</p>
                    <p>üìã Project Brief Template</p>
                    <p>üìã Invoice Template</p>
                    <button class="pixel-button">ACCESS TEMPLATES</button>
                </div>
                <div class="module-item">
                    <h3>TRAINING MATERIALS</h3>
                    <p>üéì New Software Tutorials</p>
                    <p>üéì Client Communication 101</p>
                    <p>üéì Project Management Basics</p>
                </div>
            </div>
        </div>
        
        
        <div class="taskbar">
            <button class="start-button" onclick="handleStartButton()">
                <span class="ralph-logo"></span>
                START
            </button>
            <div class="clock" id="clock">
                12:00 PM
                <div class="timezone-panel">
                    <div class="timezone-header">WORLD CLOCKS</div>
                    <div class="timezone-item">
                        <div>
                            <div class="timezone-label">LA</div>
                            <div class="timezone-city">Los Angeles</div>
                        </div>
                        <div class="timezone-time" id="timezone-la">12:00 PM</div>
                    </div>
                    <div class="timezone-item">
                        <div>
                            <div class="timezone-label">NY</div>
                            <div class="timezone-city">New York</div>
                        </div>
                        <div class="timezone-time" id="timezone-ny">3:00 PM</div>
                    </div>
                    <div class="timezone-item">
                        <div>
                            <div class="timezone-label">LDN</div>
                            <div class="timezone-city">London</div>
                        </div>
                        <div class="timezone-time" id="timezone-ldn">8:00 PM</div>
                    </div>
                    <div class="timezone-item">
                        <div>
                            <div class="timezone-label">TYO</div>
                            <div class="timezone-city">Tokyo</div>
                        </div>
                        <div class="timezone-time" id="timezone-tyo">5:00 AM</div>
                    </div>
                    <div class="timezone-item">
                        <div>
                            <div class="timezone-label">MUM</div>
                            <div class="timezone-city">Mumbai</div>
                        </div>
                        <div class="timezone-time" id="timezone-mum">1:30 AM</div>
                    </div>
                </div>
            </div>
            <button class="sound-button" onclick="toggleMusicPlayer()" title="Music Player">
                üéµ
            </button>
        </div>
        
        <div class="notification" id="notification">
            <span id="notificationText">System Alert!</span>
        </div>

        <!-- Music Player -->
        <div class="music-player" id="musicPlayer">
            <div class="player-header">
                <span>RALPH PLAYER v1.0</span>
                <button class="player-close" onclick="toggleMusicPlayer()">‚úï</button>
            </div>
            <div class="player-display">
                <div class="track-info" id="trackInfo">No track loaded</div>
                <div class="track-time" id="trackTime">00:00 / 00:00</div>
            </div>
            <div class="player-controls">
                <button class="control-btn" onclick="previousTrack()" title="Previous">‚èÆ</button>
                <button class="control-btn play" onclick="togglePlayPause()" id="playBtn" title="Play/Pause">‚ñ∂</button>
                <button class="control-btn" onclick="nextTrack()" title="Next">‚è≠</button>
                <button class="control-btn" onclick="stopTrack()" title="Stop">‚èπ</button>
            </div>
            <div class="volume-section">
                <span class="volume-label">VOL</span>
                <input type="range" class="volume-slider" min="0" max="100" value="70" oninput="setVolume(this.value)" id="volumeSlider">
            </div>
        </div>
        
        <!-- Admin Login Window -->
        <div id="adminLogin" class="window" style="top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 300px;">
            <div class="window-header">
                <div class="window-title">‚öôÔ∏è Admin Access Required</div>
                <div class="window-controls">
                    <button class="window-button" onclick="closeWindow('adminLogin')">X</button>
                </div>
            </div>
            <div class="window-content" style="display: flex; flex-direction: column; justify-content: center; padding: 24px;">
                <div class="ascii-art" style="text-align: center; margin-bottom: 20px;">
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë      ADMIN ACCESS        ‚ïë
    ‚ïë    SECURITY REQUIRED     ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                </div>
                <form id="adminLoginForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: bold;">USERNAME:</label>
                        <input type="text" id="adminUsername" value="ralph" style="width: 100%; padding: 8px; background: #000; color: #00ff00; border: 2px solid #808080; font-family: 'VT323', monospace; font-size: 16px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: bold;">PASSWORD:</label>
                        <input type="password" id="adminPassword" value="admin123" style="width: 100%; padding: 8px; background: #000; color: #00ff00; border: 2px solid #808080; font-family: 'VT323', monospace; font-size: 16px;">
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 16px;">
                        <button type="submit" class="pixel-button" style="flex: 1;">ACCESS CMS</button>
                        <button type="button" class="pixel-button" onclick="closeWindow('adminLogin')" style="flex: 1;">CANCEL</button>
                    </div>
                </form>
                <div id="adminLoginError" style="display: none; margin-top: 16px; color: #ff0000; text-align: center; font-weight: bold;">
                    ‚ö†Ô∏è ACCESS DENIED - Invalid credentials
                </div>
            </div>
        </div>
    </div>
    
    <!-- Welcome Banner Popup -->
    <div id="welcomeBanner" class="banner-popup">
        <div class="banner-header">
            üéâ WELCOME TO THE RALPH HUB! üéâ
        </div>
        <div class="banner-content">
            <div class="banner-text">
                HEY, <span class="banner-highlight">RALPHIE!</span> This is our new information hub for all things Ralph. 
            </div>
            <div class="banner-text">
                Use the <span class="banner-highlight">Suggestion Box</span> for any ideas for things you'd like to see on here.
            </div>
            <button class="banner-close" onclick="closeBanner()">GOT IT!</button>
        </div>
    </div>
    
    <!-- Weekly Share Challenge Popup -->
    <div id="sharePopup" class="share-popup" style="display: none;">
        <div class="share-popup-content">
            <div class="share-header">
                <h2>üì≤ 3 RALPH THINGS TO SHARE THIS WEEK!</h2>
                <div class="share-week">Week of <span id="shareWeek">August 20, 2024</span></div>
                <button class="share-close" onclick="closeSharePopup()">√ó</button>
            </div>
            
            <div class="share-intro">
                <p>üéâ Help spread the RALPH love! Share these posts and you'll be entered to win a <strong id="giftCardAmount">$25 gift card</strong>!</p>
            </div>
            
            <div class="share-items" id="shareItems">
                <!-- Items will be populated dynamically -->
            </div>
            
            <div class="share-footer" id="shareFooter">
                <div class="share-progress">
                    <span id="shareProgress">0 of 3 shared</span>
                </div>
                <button class="share-submit-btn" id="shareSubmitBtn" onclick="submitShares()" disabled>
                    üéØ ENTER SWEEPSTAKES
                </button>
            </div>
            
            <div class="share-success" id="shareSuccess" style="display: none;">
                <div class="success-message">
                    <h3>üéâ Thank You!</h3>
                    <p>You've been entered into this week's sweepstakes!</p>
                    <p class="comeback-message">Come back next week for another chance to win!</p>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        .share-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
        }
        
        .share-popup-content {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 3px solid var(--ralph-pink);
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(235, 0, 139, 0.3);
            animation: popupSlideIn 0.3s ease-out;
        }
        
        @keyframes popupSlideIn {
            from { transform: scale(0.8) translateY(-50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .share-header {
            background: var(--ralph-pink);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            border-radius: 12px 12px 0 0;
        }
        
        .share-header h2 {
            margin: 0;
            font-size: 24px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }
        
        .share-week {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .share-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .share-close:hover {
            color: #ffccdd;
        }
        
        .share-intro {
            padding: 20px;
            text-align: center;
            color: #e0e0e0;
            background: rgba(235, 0, 139, 0.1);
        }
        
        .share-intro p {
            margin: 0;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .share-items {
            padding: 0 20px;
        }
        
        .share-item {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #404040;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .share-item:hover {
            border-color: var(--ralph-pink);
            box-shadow: 0 5px 15px rgba(235, 0, 139, 0.2);
        }
        
        .share-item.completed {
            border-color: #00ff41;
            background: rgba(0, 255, 65, 0.1);
        }
        
        .share-thumbnail {
            width: 120px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px 0 0 8px;
        }
        
        .share-content {
            flex: 1;
            padding: 15px;
            color: white;
        }
        
        .share-content h4 {
            margin: 0 0 5px 0;
            color: var(--ralph-pink);
            font-size: 16px;
        }
        
        .share-type {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .share-description {
            font-size: 13px;
            color: #ccc;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .share-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .share-link-btn {
            background: var(--ralph-pink);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .share-link-btn:hover {
            background: #c7007a;
        }
        
        .share-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #ccc;
        }
        
        .share-checkbox input {
            transform: scale(1.2);
        }
        
        .share-footer {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            text-align: center;
            border-radius: 0 0 12px 12px;
        }
        
        .share-progress {
            color: #ccc;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .share-submit-btn {
            background: linear-gradient(45deg, var(--ralph-pink), #ff1493);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(235, 0, 139, 0.3);
        }
        
        .share-submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(235, 0, 139, 0.4);
        }
        
        .share-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .share-success {
            padding: 40px 20px;
            text-align: center;
            color: white;
        }
        
        .success-message h3 {
            color: var(--ralph-pink);
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .success-message p {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .comeback-message {
            color: #00ff41;
            font-weight: bold;
            margin-top: 20px !important;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }
        
        @media (max-width: 768px) {
            .share-popup-content {
                width: 95%;
                max-height: 95vh;
            }
            
            .share-item {
                flex-direction: column;
            }
            
            .share-thumbnail {
                width: 100%;
                height: 150px;
                border-radius: 8px 8px 0 0;
            }
            
            .share-header h2 {
                font-size: 20px;
            }
        }
    </style>
    
    <script>
        'use strict';
        
        // Global state management
        const AppState = {
            windows: {},
            activeWindow: null,
            zIndex: 100,
            isMobile: false,
            touchDevice: false,
            config: null,
            apiIntegration: null,
            chatbotAI: null,
            intervals: [],  // Track all intervals for cleanup
            timeouts: [],   // Track all timeouts for cleanup
            rafIds: []      // Track animation frame IDs
        };
        
        // DOM element cache for better performance
        const DOMCache = {
            elements: {},
            get(id) {
                if (!this.elements[id]) {
                    this.elements[id] = document.getElementById(id);
                }
                return this.elements[id];
            },
            querySelector(selector) {
                if (!this.elements[selector]) {
                    this.elements[selector] = document.querySelector(selector);
                }
                return this.elements[selector];
            },
            clear() {
                this.elements = {};
            }
        };
        
        // Utility functions
        const Utils = {
            isMobileDevice: () => {
                return window.innerWidth <= 768 || 
                       ('ontouchstart' in window) || 
                       (navigator.maxTouchPoints > 0);
            },
            
            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        };
        
        // Window management
        function openWindow(windowId) {
            const windowEl = document.getElementById(windowId);
            if (!windowEl) return;
            
            // Close other windows on mobile
            if (AppState.isMobile) {
                document.querySelectorAll('.window.active').forEach(w => {
                    if (w.id !== windowId) {
                        w.classList.remove('active');
                    }
                });
            }
            
            windowEl.classList.add('active');
            windowEl.style.zIndex = ++AppState.zIndex;
            AppState.activeWindow = windowId;
            
            if (!AppState.windows[windowId]) {
                AppState.windows[windowId] = { draggable: null };
                makeDraggable(windowEl);
            }
            
            // Load content for this specific module from CMS
            loadModuleContentFromCMS(windowId);
        }
        
        function closeWindow(windowId) {
            const windowEl = DOMCache.get(windowId);
            if (!windowEl) return;
            
            windowEl.classList.remove('active');
            if (AppState.activeWindow === windowId) {
                AppState.activeWindow = null;
            }
        }
        
        function minimizeWindow(windowId) {
            const windowEl = DOMCache.get(windowId);
            if (!windowEl) return;
            
            windowEl.style.display = 'none';
            setTimeout(() => {
                windowEl.style.display = '';
            }, 100);
        }
        
        function maximizeWindow(windowId) {
            const windowEl = DOMCache.get(windowId);
            if (!windowEl) return;
            
            if (AppState.isMobile) {
                // On mobile, maximizing fills the available space
                windowEl.style.cssText = `
                    position: fixed !important;
                    top: 10px !important;
                    left: 10px !important;
                    right: 10px !important;
                    bottom: 50px !important;
                    width: auto !important;
                    height: auto !important;
                `;
            } else {
                if (windowEl.dataset.maximized === 'true') {
                    // Restore
                    windowEl.style.width = windowEl.dataset.originalWidth || '';
                    windowEl.style.height = windowEl.dataset.originalHeight || '';
                    windowEl.style.top = windowEl.dataset.originalTop || '100px';
                    windowEl.style.left = windowEl.dataset.originalLeft || '100px';
                    windowEl.dataset.maximized = 'false';
                } else {
                    // Maximize
                    windowEl.dataset.originalWidth = windowEl.style.width;
                    windowEl.dataset.originalHeight = windowEl.style.height;
                    windowEl.dataset.originalTop = windowEl.style.top;
                    windowEl.dataset.originalLeft = windowEl.style.left;
                    
                    windowEl.style.width = '90vw';
                    windowEl.style.height = '80vh';
                    windowEl.style.top = '20px';
                    windowEl.style.left = '5vw';
                    windowEl.dataset.maximized = 'true';
                }
            }
        }
        
        function makeDraggable(element) {
            if (AppState.isMobile) return; // Disable dragging on mobile
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            const header = element.querySelector('.window-header');
            if (!header) return;
            
            const dragMouseDown = (e) => {
                e = e || window.event;
                e.preventDefault();
                
                if (e.type === 'touchstart') {
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                } else {
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                }
                
                document.onmouseup = closeDragElement;
                document.ontouchend = closeDragElement;
                document.onmousemove = elementDrag;
                document.ontouchmove = elementDrag;
                element.style.zIndex = ++AppState.zIndex;
            };
            
            const elementDrag = (e) => {
                e = e || window.event;
                e.preventDefault();
                
                let clientX, clientY;
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                pos1 = pos3 - clientX;
                pos2 = pos4 - clientY;
                pos3 = clientX;
                pos4 = clientY;
                
                const newTop = element.offsetTop - pos2;
                const newLeft = element.offsetLeft - pos1;
                
                // Boundary checking
                const maxTop = window.innerHeight - element.offsetHeight;
                const maxLeft = window.innerWidth - element.offsetWidth;
                
                element.style.top = Math.max(0, Math.min(newTop, maxTop)) + "px";
                element.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + "px";
            };
            
            const closeDragElement = () => {
                document.onmouseup = null;
                document.ontouchend = null;
                document.onmousemove = null;
                document.ontouchmove = null;
            };
            
            header.onmousedown = dragMouseDown;
            header.ontouchstart = dragMouseDown;
        }
        
        // Clock update
        function updateClock() {
            const now = new Date();
            
            // Local time (main clock)
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            const clockEl = document.getElementById('clock');
            
            if (clockEl) {
                // Update main clock text (need to preserve the timezone panel HTML)
                const timezonePanel = clockEl.querySelector('.timezone-panel');
                clockEl.innerHTML = `${displayHours}:${minutes} ${ampm}`;
                if (timezonePanel) {
                    clockEl.appendChild(timezonePanel);
                }
            }
            
            // Update timezone clocks
            updateTimezoneClocks();
        }

        function updateTimezoneClocks() {
            const now = new Date();
            
            // Define timezones with their UTC offsets (considering DST is complex, using standard time)
            const timezones = [
                { id: 'timezone-la', offset: -8, dst: true },    // Los Angeles (PST/PDT)
                { id: 'timezone-ny', offset: -5, dst: true },    // New York (EST/EDT)  
                { id: 'timezone-ldn', offset: 0, dst: true },    // London (GMT/BST)
                { id: 'timezone-tyo', offset: 9, dst: false },   // Tokyo (JST)
                { id: 'timezone-mum', offset: 5.5, dst: false }  // Mumbai (IST)
            ];
            
            timezones.forEach(tz => {
                const element = document.getElementById(tz.id);
                if (element) {
                    // Get current month to determine DST (simplified - March to October)
                    const month = now.getMonth() + 1;
                    const isDSTActive = tz.dst && (month >= 3 && month <= 10);
                    const effectiveOffset = tz.offset + (isDSTActive ? 1 : 0);
                    
                    // Calculate timezone time
                    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                    const timezoneTime = new Date(utc + (effectiveOffset * 3600000));
                    
                    const tzHours = timezoneTime.getHours();
                    const tzMinutes = timezoneTime.getMinutes().toString().padStart(2, '0');
                    const tzAmpm = tzHours >= 12 ? 'PM' : 'AM';
                    const tzDisplayHours = tzHours % 12 || 12;
                    
                    element.textContent = `${tzDisplayHours}:${tzMinutes} ${tzAmpm}`;
                }
            });
        }
        
        // Iframe Window Management
        let iframeWindows = [];
        let iframeCounter = 0;

        function createIframeWindow(url, title) {
            const windowId = `iframe-${++iframeCounter}`;
            const windowElement = document.createElement('div');
            windowElement.id = windowId;
            windowElement.className = 'iframe-window active';
            windowElement.style.top = `${50 + (iframeCounter * 30)}px`;
            windowElement.style.left = `${50 + (iframeCounter * 30)}px`;
            windowElement.style.width = '800px';
            windowElement.style.height = '600px';

            windowElement.innerHTML = `
                <div class="iframe-header">
                    <div class="iframe-title">${title}</div>
                    <div class="iframe-controls">
                        <button class="iframe-control-btn" onclick="maximizeIframeWindow('${windowId}')" title="Maximize">üóñ</button>
                        <button class="iframe-control-btn" onclick="closeIframeWindow('${windowId}')" title="Close">‚úï</button>
                    </div>
                </div>
                <div class="iframe-loading">Loading...</div>
            `;

            document.body.appendChild(windowElement);
            iframeWindows.push({id: windowId, element: windowElement, url: url, title: title});
            
            // Make window draggable
            makeIframeDraggable(windowElement);
            
            // Load content after a brief delay
            setTimeout(() => {
                loadIframeContent(windowId, url);
            }, 500);

            return windowId;
        }

        function loadIframeContent(windowId, url) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                const loadingDiv = windowElement.querySelector('.iframe-loading');
                if (loadingDiv) {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'iframe-content';
                    iframe.src = url;
                    iframe.onload = () => {
                        loadingDiv.style.display = 'none';
                    };
                    iframe.onerror = () => {
                        loadingDiv.textContent = 'Failed to load content';
                    };
                    loadingDiv.parentNode.replaceChild(iframe, loadingDiv);
                }
            }
        }

        function closeIframeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.remove();
                iframeWindows = iframeWindows.filter(w => w.id !== windowId);
            }
        }

        function maximizeIframeWindow(windowId) {
            const windowData = iframeWindows.find(w => w.id === windowId);
            if (windowData) {
                // Open in new browser tab
                window.open(windowData.url, '_blank');
                // Optionally close the iframe window
                closeIframeWindow(windowId);
            }
        }

        function makeIframeDraggable(windowElement) {
            const header = windowElement.querySelector('.iframe-header');
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            header.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                
                // Bring to front
                windowElement.style.zIndex = 1001;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                windowElement.style.top = (windowElement.offsetTop - pos2) + "px";
                windowElement.style.left = (windowElement.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Sound effect with proper user gesture handling
        let audioContext = null;
        let audioEnabled = false;
        
        function initAudio() {
            if (!audioEnabled && (window.AudioContext || window.webkitAudioContext)) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(() => {
                            audioEnabled = true;
                        });
                    } else {
                        audioEnabled = true;
                    }
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
        }
        
        function beep() {
            // Only try to play sound if audio has been properly initialized
            if (audioEnabled && audioContext && audioContext.state === 'running') {
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'square';
                    gainNode.gain.value = 0.1;
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.05);
                } catch (e) {
                    // Silently fail if audio error occurs
                }
            }
            // If audio not enabled, just continue silently (no error)
        }
        
        // Notification system
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            if (!notification || !notificationText) return;
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // START button functionality
        function handleStartButton() {
            const chatbotWindow = document.getElementById('chatbot');
            if (chatbotWindow && !chatbotWindow.classList.contains('active')) {
                openWindow('chatbot');
                showNotification('RALPH Assistant activated!');
            } else {
                showNotification('Assistant already running!');
            }
        }

        // Enhanced chatbot functionality with AI integration
        async function sendChat() {
            console.log('üí¨ sendChat called');
            const input = DOMCache.get('chatInput');
            const display = DOMCache.get('chatDisplay');
            if (!input || !display) return;
            
            const message = input.value.trim();
            if (message === '') return;
            
            console.log('üìù Processing message:', message);
            
            // Use DocumentFragment for batch DOM updates
            const fragment = document.createDocumentFragment();
            
            // Remove blinking cursor
            const cursor = display.querySelector('.blink');
            if (cursor) cursor.remove();
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.style.marginTop = '10px';
            userMsg.style.color = '#00ff00';
            userMsg.innerHTML = `<span style="color: #ffffff;">USER:</span> ${message}`;
            fragment.appendChild(userMsg);
            
            // Add loading indicator
            const loadingMsg = document.createElement('div');
            loadingMsg.style.marginTop = '10px';
            loadingMsg.style.color = '#00ff00';
            loadingMsg.innerHTML = `<span style="color: #ffff00;">ASSISTANT:</span> <span class="blink">Processing...</span>`;
            fragment.appendChild(loadingMsg);
            
            // Batch append to DOM
            display.appendChild(fragment);
            display.scrollTop = display.scrollHeight;
            
            // Process bot response
            let response = '';
            const lowerMsg = message.toLowerCase();
            
            // Handle built-in commands first
            if (lowerMsg.includes('help')) {
                response = `Available commands:
‚ñ∫ 'status' - Check system status
‚ñ∫ 'time' - Get current time
‚ñ∫ 'clear' - Clear chat history
‚ñ∫ 'modules' - List all modules
‚ñ∫ 'tips' - Show productivity tips
‚ñ∫ 'refresh' - Update all module content`;
            } else if (lowerMsg.includes('status')) {
                response = 'All systems operational. Network: ONLINE. Projects: 47 active.';
            } else if (lowerMsg.includes('time')) {
                const now = new Date();
                response = `Current time: ${now.toLocaleTimeString()}`;
            } else if (lowerMsg.includes('clear')) {
                display.innerHTML = `<div style="color: #EB008B;">Chat cleared.</div>`;
                if (AppState.chatbotAI) {
                    AppState.chatbotAI.clearHistory();
                }
                input.value = '';
                return;
            } else if (lowerMsg.includes('modules')) {
                const enabledModules = Object.entries(AppState.config?.modules || {})
                    .filter(([id, config]) => config.enabled)
                    .map(([id, config]) => config.title)
                    .join(', ');
                response = `Available modules: ${enabledModules}`;
            } else if (lowerMsg.includes('tips')) {
                response = AppState.isMobile ? 
                    'Pro tip: Tap any icon to open its module!' : 
                    'Pro tip: Hold SHIFT while clicking to open multiple windows at once!';
            } else if (lowerMsg.includes('refresh')) {
                refreshAllModules();
                response = 'Refreshing all module content from APIs...';
            } else {
                // Use server-side chatbot endpoint
                try {
                    // Collect conversation history for context
                    const history = [];
                    const messages = display.querySelectorAll('div');
                    messages.forEach(msg => {
                        const text = msg.textContent;
                        if (text.startsWith('USER:')) {
                            history.push({ role: 'user', content: text.replace('USER: ', '') });
                        } else if (text.startsWith('ASSISTANT:') && !text.includes('Processing...')) {
                            history.push({ role: 'assistant', content: text.replace('ASSISTANT: ', '') });
                        }
                    });
                    
                    // Call server endpoint
                    const apiResponse = await fetch('/api/chatbot', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: message,
                            history: history.slice(-10) // Send last 10 messages for context
                        })
                    });
                    
                    const result = await apiResponse.json();
                    console.log('ü§ñ API response received:', result);
                    response = result.response;
                    
                    if (result.fallback) {
                        console.log('Using fallback response (API key not configured or error occurred)');
                    }
                } catch (error) {
                    console.error('Chatbot API error:', error);
                    // Fallback responses
                    const responses = AppState.config?.chatbot?.openai?.fallbackResponses || [
                        'I\'m having trouble processing that right now.',
                        'Let me think about that...',
                        'Interesting question! Tell me more.',
                        'System processing...'
                    ];
                    response = responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            console.log('‚úÖ Final response:', response);
            
            // Remove loading indicator and add actual response
            try {
                if (loadingMsg && loadingMsg.parentNode) {
                    display.removeChild(loadingMsg);
                    console.log('üóëÔ∏è Loading message removed');
                }
            } catch (error) {
                console.log('Error removing loading message:', error);
            }
            
            const botMsg = document.createElement('div');
            botMsg.style.marginTop = '10px';
            botMsg.style.color = '#00ff00';
            botMsg.innerHTML = `<span style="color: #ffff00;">ASSISTANT:</span> ${response}`;
            display.appendChild(botMsg);
            console.log('üì® Bot response added to display');
            
            // Add new cursor
            const newCursor = document.createElement('div');
            newCursor.style.marginTop = '10px';
            newCursor.style.color = '#00ff00';
            newCursor.className = 'blink';
            newCursor.textContent = '> _';
            display.appendChild(newCursor);
            
            // Clear input and scroll to bottom
            input.value = '';
            display.scrollTop = display.scrollHeight;
        }

        // CMS Functions
        // Load pipeline data and render
        function loadPipelineData(data) {
            const stages = ['warmLeads', 'pitchesHappening', 'pitchSubmitted', 'pitchPresented', 'pitchWon'];
            
            stages.forEach(stage => {
                const container = DOMCache.get(stage);
                if (!container) return;
                
                const items = data[stage] || [];
                
                // Update count in header
                const column = container.parentElement;
                const countSpan = column.querySelector('.count');
                if (countSpan) {
                    countSpan.textContent = `(${items.length})`;
                }
                
                // Clear existing items
                container.innerHTML = '';
                
                // Add items
                items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'pipeline-item';
                    
                    itemEl.innerHTML = `
                        <div class="client-name">${item.name || 'Untitled Project'}</div>
                        <div class="office">[${item.office || 'NYC'}]</div>
                        <div class="due-date">üìÖ ${item.dueDate ? new Date(item.dueDate).toLocaleDateString() : 'TBD'}</div>
                        <div class="links">
                            ${item.deckLink ? `<a href="#" class="link-btn" onclick="openIframeWindow('${item.deckLink}', '${item.name} - Deck', 900, 700)">DECK</a>` : ''}
                            ${item.briefLink ? `<a href="#" class="link-btn" onclick="openIframeWindow('${item.briefLink}', '${item.name} - Brief', 900, 700)">BRIEF</a>` : ''}
                        </div>
                    `;
                    
                    container.appendChild(itemEl);
                });
            });
        }
        
        // Open document in iframe window
        function openIframe(url, title) {
            // Create iframe window
            const iframeWindow = document.createElement('div');
            iframeWindow.className = 'window';
            iframeWindow.style.cssText = `
                top: 80px; 
                left: 80px; 
                width: 800px; 
                height: 600px; 
                z-index: ${AppState.zIndex++};
            `;
            
            iframeWindow.innerHTML = `
                <div class="window-header">
                    <div class="window-title">üìÑ ${title}</div>
                    <div class="window-controls">
                        <button class="window-button" onclick="this.parentElement.parentElement.parentElement.remove()">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 0;">
                    <iframe src="${url}" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
                </div>
            `;
            
            document.body.appendChild(iframeWindow);
            makeDraggable(iframeWindow);
        }

        function loadModuleContentFromCMS(moduleId) {
            console.log(`üìÑ LOADING CONTENT FROM CMS FOR MODULE: ${moduleId}`);
            if (!AppState.config || !AppState.config.modules) {
                console.log('‚ö†Ô∏è No config available, skipping content load');
                return;
            }
            
            const moduleConfig = AppState.config.modules[moduleId];
            if (!moduleConfig || !moduleConfig.enabled) {
                console.log(`‚ö†Ô∏è Module ${moduleId} not found or disabled`);
                return;
            }
            
            const windowElement = document.getElementById(moduleId);
            if (windowElement) {
                const title = windowElement.querySelector('.window-title');
                if (title) {
                    title.textContent = `${moduleConfig.icon} ${moduleConfig.title}`;
                }
                
                // Update specific module content
                if (moduleId === 'newBiz' && moduleConfig.content) {
                    console.log('üìä Loading New Business Pipeline content');
                    loadPipelineData(moduleConfig.content);
                } else if (moduleId === 'challenge' && moduleConfig.content) {
                    updateChallengeContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'shoutouts' && moduleConfig.content) {
                    updateShoutoutsContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'premieres' && moduleConfig.content) {
                    updatePremieresContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'ralphNews' && moduleConfig.content) {
                    updateRalphNewsContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'suggestions' && moduleConfig.content) {
                    updateSuggestionsContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'announcements' && moduleConfig.content) {
                    updateAnnouncementsContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'articles' && moduleConfig.content) {
                    updateArticlesContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'innovation' && moduleConfig.content) {
                    updateInnovationContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'resources' && moduleConfig.content) {
                    updateResourcesContent(windowElement, moduleConfig.content);
                } else if (moduleId === 'links' && moduleConfig.content) {
                    updateLinksContent(windowElement, moduleConfig.content);
                }
            }
        }

        function loadContentFromCMS() {
            console.log('üìÑ LOADING CONTENT FROM CMS');
            if (!AppState.config) {
                console.log('‚ö†Ô∏è No config available, skipping content load');
                return;
            }
            console.log('üìù Loading modules:', Object.keys(AppState.config.modules || {}));
            
            // Update chatbot welcome message
            const welcomeArea = document.querySelector('#chatDisplay');
            if (welcomeArea && AppState.config.chatbot) {
                const chatConfig = AppState.config.chatbot;
                welcomeArea.innerHTML = `
                    <div style="color: #EB008B;">=======================================</div>
                    <div style="color: #EB008B;">${chatConfig.title.toUpperCase()} - INITIALIZED</div>
                    <div style="color: #EB008B;">=======================================</div>
                    <div style="margin-top: 10px;">
                        <span style="color: #ffff00;">ASSISTANT:</span> ${chatConfig.welcomeMessage}
                    </div>
                    <div style="margin-top: 10px;">
                        ${chatConfig.helpText}
                    </div>
                    <div style="margin-top: 10px;">
                        <span style="color: #ffff00;">TIP:</span> Press ESC to close all windows
                    </div>
                    <div style="margin-top: 10px;">
                        Type 'help' for more commands or ask me anything!
                    </div>
                    <div style="margin-top: 10px; color: #00ff00;" class="blink">
                        > _
                    </div>
                `;
            }
            
            // Update module icons and titles
            Object.entries(AppState.config.modules).forEach(([moduleId, moduleConfig]) => {
                if (!moduleConfig.enabled) {
                    const icon = document.querySelector(`[onclick="openWindow('${moduleId}')"]`);
                    if (icon) icon.style.display = 'none';
                    return;
                }
                
                const windowElement = document.getElementById(moduleId);
                if (windowElement) {
                    const title = windowElement.querySelector('.window-title');
                    if (title) {
                        title.textContent = `${moduleConfig.icon} ${moduleConfig.title}`;
                    }
                    
                    // Update specific module content
                    if (moduleId === 'newBiz' && moduleConfig.content) {
                        loadPipelineData(moduleConfig.content);
                    } else if (moduleId === 'challenge' && moduleConfig.content) {
                        updateChallengeContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'shoutouts' && moduleConfig.content) {
                        updateShoutoutsContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'premieres' && moduleConfig.content) {
                        updatePremieresContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'ralphNews' && moduleConfig.content) {
                        updateRalphNewsContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'suggestions' && moduleConfig.content) {
                        updateSuggestionsContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'announcements' && moduleConfig.content) {
                        updateAnnouncementsContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'articles' && moduleConfig.content) {
                        updateArticlesContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'innovation' && moduleConfig.content) {
                        updateInnovationContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'resources' && moduleConfig.content) {
                        updateResourcesContent(windowElement, moduleConfig.content);
                    } else if (moduleId === 'links' && moduleConfig.content) {
                        updateLinksContent(windowElement, moduleConfig.content);
                    }
                }
            });
        }

        // Update New Business Pipeline content dynamically
        function updateNewBizContent(windowElement, content) {
            console.log('üîÑ Updating New Biz Pipeline content:', content);
            
            const windowContent = windowElement.querySelector('.window-content');
            if (!windowContent) return;
            
            // Pipeline stage definitions
            const stages = {
                warmLeads: { name: 'WARM LEADS', color: '#ef4444' },
                pitchesHappening: { name: 'PITCHES HAPPENING', color: '#f97316' },
                pitchSubmitted: { name: 'PITCH SUBMITTED', color: '#eab308' },
                pitchPresented: { name: 'PITCH PRESENTED', color: '#22c55e' },
                pitchWon: { name: 'PITCH WON', color: '#3b82f6' }
            };
            
            // Build pipeline columns HTML
            let pipelineHtml = '';
            Object.entries(stages).forEach(([stageKey, stage]) => {
                const items = content[stageKey] || [];
                const count = items.length;
                
                let itemsHtml = '';
                items.forEach(item => {
                    const deckLinkHtml = item.deckLink ? 
                        `<button onclick="openIframeWindow('${item.deckLink}', '${item.name} - Deck', 900, 700)" style="background: #EB008B; color: white; border: none; padding: 2px 6px; margin: 2px; cursor: pointer; border-radius: 2px; font-size: 10px;">[DECK]</button>` : '';
                    const briefLinkHtml = item.briefLink ? 
                        `<button onclick="openIframeWindow('${item.briefLink}', '${item.name} - Brief', 900, 700)" style="background: #059669; color: white; border: none; padding: 2px 6px; margin: 2px; cursor: pointer; border-radius: 2px; font-size: 10px;">[BRIEF]</button>` : '';
                    
                    // Smart data detection in case fields are swapped
                    let dueDate = '';
                    let office = '';
                    
                    // Check if dueDate looks like a date (contains numbers) or office code
                    if (item.dueDate && item.dueDate.match(/\d{4}-\d{2}-\d{2}/)) {
                        dueDate = new Date(item.dueDate).toLocaleDateString();
                    } else if (item.dueDate && item.dueDate.match(/^(LON|NY|LA|TK)$/)) {
                        office = `[${item.dueDate}]`; // dueDate field contains office
                    }
                    
                    // Check if office looks like a date or office code
                    if (item.office && item.office.match(/\d{4}-\d{2}-\d{2}/)) {
                        dueDate = new Date(item.office).toLocaleDateString(); // office field contains date
                    } else if (item.office && item.office.match(/^(LON|NY|LA|TK)$/)) {
                        office = `[${item.office}]`;
                    }
                    
                    itemsHtml += `
                        <div class="pipeline-item" style="background: rgba(0,0,0,0.3); padding: 8px; margin: 4px 0; border-radius: 4px; font-size: 11px;">
                            <div style="font-weight: bold; color: white; margin-bottom: 4px;">${item.name}</div>
                            <div style="color: #b0b0b0; margin-bottom: 4px;">
                                ${dueDate ? `üìÖ ${dueDate}` : ''} ${office}
                            </div>
                            <div>${deckLinkHtml}${briefLinkHtml}</div>
                        </div>
                    `;
                });
                
                pipelineHtml += `
                    <div class="pipeline-column" style="flex: 1; margin: 0 4px; min-height: 200px;">
                        <div class="pipeline-header" style="background: ${stage.color}; color: white; padding: 8px; text-align: center; font-weight: bold; font-size: 11px; margin-bottom: 8px; border-radius: 4px;">
                            ${stage.name} <span style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 10px; margin-left: 4px;">(${count})</span>
                        </div>
                        <div class="pipeline-items" style="min-height: 150px;">
                            ${itemsHtml}
                        </div>
                    </div>
                `;
            });
            
            // Update the window content with horizontal layout
            windowContent.innerHTML = `
                <div class="ascii-art" style="margin-bottom: 12px;">
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë  ${content.header || 'RALPH PIPELINE TRACKER 1.0'}  ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                </div>
                <div class="pipeline-container" style="display: flex; gap: 8px; height: 250px; overflow-x: auto;">
                    ${pipelineHtml}
                </div>
            `;
            
            console.log('‚úÖ New Biz Pipeline content updated successfully');
        }

        // Update Industry Articles content dynamically
        function updateArticlesContent(windowElement, content) {
            console.log('üîÑ Updating Industry Articles content:', content);
            
            const windowContent = windowElement.querySelector('.window-content');
            if (!windowContent) return;
            
            // Build trending articles HTML
            let trendingHtml = '';
            if (content.trending) {
                content.trending.forEach(article => {
                    const title = typeof article === 'string' ? article : (article.title || '');
                    const url = typeof article === 'object' ? (article.url || '') : '';
                    const linkHtml = url ? 
                        ` <button onclick="openIframeWindow('${url}', '${title}', 800, 600)" style="background: #EB008B; color: white; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[OPEN]</button>` : '';
                    
                    trendingHtml += `<p>üìà ${title}${linkHtml}</p>`;
                });
            }
            
            // Build must reads HTML
            let mustReadsHtml = '';
            if (content.mustReads) {
                content.mustReads.forEach(item => {
                    const linkHtml = item.url ? 
                        ` <button onclick="openIframeWindow('${item.url}', '${item.title}', 800, 600)" style="background: #EB008B; color: white; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[OPEN]</button>` : '';
                    mustReadsHtml += `<p>üìñ ${item.source}: ${item.title}${linkHtml}</p>`;
                });
            }
            
            // Update the window content
            windowContent.innerHTML = `
                <div class="module-item">
                    <h3>TRENDING ARTICLES</h3>
                    ${trendingHtml}
                </div>
                <div class="module-item">
                    <h3>MUST READS</h3>
                    ${mustReadsHtml}
                </div>
            `;
            
            console.log('‚úÖ Industry Articles content updated successfully');
        }

        // Update Innovation content dynamically
        function updateInnovationContent(windowElement, content) {
            console.log('üîÑ Updating Innovation content:', content);
            
            const windowContent = windowElement.querySelector('.window-content');
            if (!windowContent) return;
            
            // Build experiments HTML
            let experimentsHtml = '';
            if (content.experiments) {
                content.experiments.forEach(experiment => {
                    const linkHtml = experiment.url ? 
                        ` <button onclick="openIframeWindow('${experiment.url}', '${experiment.name}', 1000, 700)" style="background: #EB008B; color: white; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[VIEW]</button>` : '';
                    
                    experimentsHtml += `
                        <p>üî¨ ${experiment.name}${linkHtml}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${experiment.progress}%;"></div>
                        </div>
                    `;
                });
            }
            
            // Build next session HTML
            const nextSession = content.nextSession || {};
            const sessionHtml = `
                <div class="module-item">
                    <h3>NEXT SESSION</h3>
                    <p>üí° Topic: ${nextSession.topic || 'TBA'}</p>
                    <p>üé§ Speaker: ${nextSession.speaker || 'TBA'}</p>
                </div>
            `;
            
            // Update the window content
            windowContent.innerHTML = `
                <div class="module-item">
                    <h3>CURRENT EXPERIMENTS</h3>
                    ${experimentsHtml}
                </div>
                ${sessionHtml}
            `;
            
            console.log('‚úÖ Innovation content updated successfully');
        }

        // Update Resources content dynamically
        function updateResourcesContent(windowElement, content) {
            console.log('üîÑ Updating Resources content:', content);
            
            const windowContent = windowElement.querySelector('.window-content');
            if (!windowContent) return;
            
            // Build documents HTML
            let documentsHtml = '';
            if (content.documents) {
                content.documents.forEach(doc => {
                    const name = typeof doc === 'string' ? doc : (doc.name || '');
                    const url = typeof doc === 'object' ? (doc.url || '') : '';
                    const linkHtml = url ? 
                        ` <button onclick="openIframeWindow('${url}', '${name}', 800, 600)" style="background: #00ff00; color: black; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[DOWNLOAD]</button>` : '';
                    
                    documentsHtml += `<p>üìÑ ${name}${linkHtml}</p>`;
                });
            }
            
            // Build templates HTML
            let templatesHtml = '';
            if (content.templates) {
                content.templates.forEach(template => {
                    const name = typeof template === 'string' ? template : (template.name || '');
                    const url = typeof template === 'object' ? (template.url || '') : '';
                    const linkHtml = url ? 
                        ` <button onclick="openIframeWindow('${url}', '${name}', 800, 600)" style="background: #00ff00; color: black; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[DOWNLOAD]</button>` : '';
                    
                    templatesHtml += `<p>üìã ${name}${linkHtml}</p>`;
                });
            }
            
            // Build training HTML
            let trainingHtml = '';
            if (content.training) {
                content.training.forEach(course => {
                    const name = typeof course === 'string' ? course : (course.name || '');
                    const url = typeof course === 'object' ? (course.url || '') : '';
                    const linkHtml = url ? 
                        ` <button onclick="openIframeWindow('${url}', '${name}', 800, 600)" style="background: #00ff00; color: black; border: none; padding: 2px 6px; cursor: pointer; border-radius: 2px; font-size: 12px;">[START]</button>` : '';
                    
                    trainingHtml += `<p>üéì ${name}${linkHtml}</p>`;
                });
            }
            
            // Update the window content
            windowContent.innerHTML = `
                <div class="module-item">
                    <h3>DOCUMENTS</h3>
                    ${documentsHtml}
                </div>
                <div class="module-item">
                    <h3>TEMPLATES</h3>
                    ${templatesHtml}
                </div>
                <div class="module-item">
                    <h3>TRAINING</h3>
                    ${trainingHtml}
                </div>
            `;
            
            console.log('‚úÖ Resources content updated successfully');
        }

        // Update Quick Links content dynamically
        function updateLinksContent(windowElement, content) {
            console.log('üîÑ Updating Quick Links content:', content);
            
            const windowContent = windowElement.querySelector('.window-content');
            if (!windowContent) return;
            
            // Build internal links HTML
            let internalHtml = '';
            if (content.internal) {
                content.internal.forEach(link => {
                    const url = link.url && link.url !== '#' ? link.url : null;
                    const buttonHtml = url ? 
                        `<button class="pixel-button" onclick="openIframeWindow('${url}', '${link.name}', 900, 700)">${link.name}</button>` :
                        `<button class="pixel-button" style="opacity: 0.5; cursor: not-allowed;">${link.name}</button>`;
                    
                    internalHtml += buttonHtml;
                });
            }
            
            // Build external links HTML
            let externalHtml = '';
            if (content.external) {
                content.external.forEach(link => {
                    const url = link.url && link.url !== '#' ? link.url : null;
                    const buttonHtml = url ? 
                        `<button class="pixel-button" onclick="openIframeWindow('${url}', '${link.name}', 900, 700)">${link.name}</button>` :
                        `<button class="pixel-button" style="opacity: 0.5; cursor: not-allowed;">${link.name}</button>`;
                    
                    externalHtml += buttonHtml;
                });
            }
            
            // Update the window content
            windowContent.innerHTML = `
                <div class="module-item">
                    <h3>INTERNAL TOOLS</h3>
                    ${internalHtml}
                </div>
                <div class="module-item">
                    <h3>EXTERNAL RESOURCES</h3>
                    ${externalHtml}
                </div>
            `;
            
            console.log('‚úÖ Quick Links content updated successfully');
        }

        // Challenge navigation system
        let challengeState = {
            currentView: 'menu', // 'menu', 'creative', 'social', 'newBusiness'
            challengeData: null
        };

        function updateChallengeContent(windowElement, content) {
            console.log('üîÑ Updating Challenge content:', content);
            
            challengeState.challengeData = content;
            showChallengeMenu();
        }

        function updateShoutoutsContent(windowElement, content) {
            console.log('üîÑ Updating Shoutouts content:', content);
            
            const contentDiv = windowElement.querySelector('.window-content');
            if (!contentDiv) return;
            
            // Format birthdays
            let birthdaysHTML = '';
            if (content.birthdays && content.birthdays.length > 0) {
                content.birthdays.forEach(birthday => {
                    const classes = birthday.highlight ? 'blink' : '';
                    birthdaysHTML += `<p class="${classes}">‚ñ∫ ${birthday.date} - ${birthday.person}${birthday.highlight ? '!' : ''}</p>`;
                });
            } else {
                birthdaysHTML = '<p>No birthdays this month</p>';
            }
            
            // Format anniversaries
            let anniversariesHTML = '';
            if (content.anniversaries && content.anniversaries.length > 0) {
                content.anniversaries.forEach(anniversary => {
                    anniversariesHTML += `<p>‚≠ê ${anniversary.years} Year${anniversary.years !== 1 ? 's' : ''} - ${anniversary.person}</p>`;
                });
            } else {
                anniversariesHTML = '<p>No work anniversaries</p>';
            }
            
            // Format shoutouts
            let shoutoutsHTML = '';
            if (content.shoutouts && content.shoutouts.length > 0) {
                content.shoutouts.forEach(shoutout => {
                    // Format multi-line messages
                    const formattedMessage = shoutout.message.replace(/\n/g, '<br>');
                    shoutoutsHTML += `<p>"${formattedMessage}" - ${shoutout.from}</p>`;
                });
            } else {
                shoutoutsHTML = '<p>No recent shoutouts</p>';
            }
            
            contentDiv.innerHTML = `
                <div class="module-item">
                    <h3>BIRTHDAYS THIS MONTH üéÇ</h3>
                    ${birthdaysHTML}
                </div>
                <div class="module-item">
                    <h3>WORK ANNIVERSARIES üéä</h3>
                    ${anniversariesHTML}
                </div>
                <div class="module-item">
                    <h3>SHOUTOUTS üì¢</h3>
                    ${shoutoutsHTML}
                    <button class="pixel-button" onclick="showNotification('Shoutout sent!')">SEND SHOUTOUT</button>
                </div>
            `;
        }

        function updatePremieresContent(windowElement, content) {
            console.log('üîÑ Updating Premieres content:', content);
            
            const contentDiv = windowElement.querySelector('.window-content');
            if (!contentDiv) return;
            
            let thisMonthHTML = '';
            if (content.thisMonth && content.thisMonth.length > 0) {
                content.thisMonth.forEach(premiere => {
                    const linkHTML = premiere.liveLink ? `<a href="${premiere.liveLink}" target="_blank" style="color: var(--ralph-pink);">WATCH</a>` : '';
                    thisMonthHTML += `<p>‚ñ∫ ${premiere.date} - ${premiere.project} ${linkHTML}</p>`;
                });
            } else {
                thisMonthHTML = '<p>No premieres this month</p>';
            }
            
            let nextMonthHTML = '';
            if (content.nextMonth && content.nextMonth.length > 0) {
                content.nextMonth.forEach(premiere => {
                    const linkHTML = premiere.liveLink ? `<a href="${premiere.liveLink}" target="_blank" style="color: var(--ralph-pink);">WATCH</a>` : '';
                    nextMonthHTML += `<p>‚ñ∫ ${premiere.date} - ${premiere.project} ${linkHTML}</p>`;
                });
            } else {
                nextMonthHTML = '<p>No upcoming premieres</p>';
            }
            
            contentDiv.innerHTML = `
                <div class="module-item">
                    <h3>THIS MONTH üìÖ</h3>
                    ${thisMonthHTML}
                </div>
                <div class="module-item">
                    <h3>COMING UP NEXT üìÜ</h3>
                    ${nextMonthHTML}
                </div>
            `;
        }

        function updateRalphNewsContent(windowElement, content) {
            console.log('üîÑ Updating RALPH News content:', content);
            
            const contentDiv = windowElement.querySelector('.window-content');
            if (!contentDiv) return;
            
            let breakingHTML = '';
            if (content.breaking && content.breaking.length > 0) {
                content.breaking.forEach(news => {
                    const liveClass = news.live ? 'blink' : '';
                    const liveText = news.live ? ' [LIVE]' : '';
                    breakingHTML += `<p class="${liveClass}">üì∞ ${news.headline}${liveText}</p>`;
                });
            } else {
                breakingHTML = '<p>No breaking news</p>';
            }
            
            let updatesHTML = '';
            if (content.updates && content.updates.length > 0) {
                content.updates.forEach(update => {
                    updatesHTML += `<p>‚ñ∫ ${update}</p>`;
                });
            } else {
                updatesHTML = '<p>No recent updates</p>';
            }
            
            contentDiv.innerHTML = `
                <div class="module-item">
                    <h3>BREAKING NEWS üî•</h3>
                    ${breakingHTML}
                </div>
                <div class="module-item">
                    <h3>COMPANY UPDATES üì¢</h3>
                    ${updatesHTML}
                </div>
            `;
        }

        function updateSuggestionsContent(windowElement, content) {
            console.log('üîÑ Updating Suggestions content:', content);
            
            const contentDiv = windowElement.querySelector('.window-content');
            if (!contentDiv) return;
            
            let suggestionsHTML = '';
            if (content.recentSuggestions && content.recentSuggestions.length > 0) {
                content.recentSuggestions.forEach(suggestion => {
                    const statusColor = {
                        'APPROVED': '#00ff00',
                        'IN REVIEW': '#ffff00',
                        'CONSIDERING': '#ff9900',
                        'REJECTED': '#ff0000'
                    }[suggestion.status] || '#ffffff';
                    
                    suggestionsHTML += `<p>üí° ${suggestion.idea} <span style="color: ${statusColor};">[${suggestion.status}]</span></p>`;
                });
            } else {
                suggestionsHTML = '<p>No recent suggestions</p>';
            }
            
            contentDiv.innerHTML = `
                <div class="module-item">
                    <h3>RECENT SUGGESTIONS üìù</h3>
                    ${suggestionsHTML}
                </div>
                <div class="module-item">
                    <textarea placeholder="Enter your suggestion..." style="width: 100%; height: 80px; background: #000; color: #fff; border: 1px solid #404040; padding: 8px; font-family: 'Courier New', monospace;"></textarea>
                    <button class="pixel-button" onclick="showNotification('Suggestion submitted!')" style="margin-top: 10px;">SUBMIT SUGGESTION</button>
                </div>
            `;
        }

        function updateAnnouncementsContent(windowElement, content) {
            console.log('üîÑ Updating Announcements content:', content);
            
            const contentDiv = windowElement.querySelector('.window-content');
            if (!contentDiv) return;
            
            let importantHTML = '';
            if (content.important && content.important.length > 0) {
                content.important.forEach(announcement => {
                    importantHTML += `<p class="blink">üö® ${announcement}</p>`;
                });
            } else {
                importantHTML = '<p>No important announcements</p>';
            }
            
            let generalHTML = '';
            if (content.general && content.general.length > 0) {
                content.general.forEach(announcement => {
                    generalHTML += `<p>‚ñ∫ ${announcement}</p>`;
                });
            } else {
                generalHTML = '<p>No general announcements</p>';
            }
            
            contentDiv.innerHTML = `
                <div class="module-item">
                    <h3>IMPORTANT NOTICES ‚ö†Ô∏è</h3>
                    ${importantHTML}
                </div>
                <div class="module-item">
                    <h3>GENERAL ANNOUNCEMENTS üì¢</h3>
                    ${generalHTML}
                </div>
            `;
        }

        function showChallengeMenu() {
            const container = document.getElementById('challenge-content');
            if (!container) return;

            challengeState.currentView = 'menu';
            
            container.innerHTML = `
                <div class="module-item">
                    <h3>CHALLENGE CATEGORIES</h3>
                    <p>Choose your challenge type:</p>
                    <div style="display: flex; flex-direction: column; gap: 12px; margin: 20px 0;">
                        <button class="pixel-button" onclick="showChallengePost('creative')" style="padding: 12px 20px;">
                            üé® ${(challengeState.challengeData && challengeState.challengeData.creative && challengeState.challengeData.creative.label) || 'CREATIVE'} CHALLENGE
                        </button>
                        <button class="pixel-button" onclick="showChallengePost('social')" style="padding: 12px 20px;">
                            üì± ${(challengeState.challengeData && challengeState.challengeData.social && challengeState.challengeData.social.label) || 'SOCIAL'} CHALLENGE
                        </button>
                        <button class="pixel-button" onclick="showChallengePost('newBusiness')" style="padding: 12px 20px;">
                            üíº ${(challengeState.challengeData && challengeState.challengeData.newBusiness && challengeState.challengeData.newBusiness.label) || 'NEW BUSINESS'} CHALLENGE
                        </button>
                    </div>
                </div>
            `;
        }

        function showChallengePost(challengeType) {
            const container = document.getElementById('challenge-content');
            if (!container || !challengeState.challengeData) return;

            const challenge = challengeState.challengeData[challengeType];
            if (!challenge) return;

            challengeState.currentView = challengeType;

            // Helper function to format multi-line text
            function formatText(text) {
                return text.replace(/\\n/g, '<br>').replace(/\n/g, '<br>');
            }

            container.innerHTML = `
                <div class="blog-post" style="padding: 20px; max-height: 400px; overflow-y: auto; max-width: 600px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <button class="pixel-button" onclick="showChallengeMenu()" style="padding: 8px 16px;">‚Üê BACK</button>
                        <h2 style="color: var(--ralph-pink); margin: 0; font-size: 18px; text-align: center; flex: 1;">
                            ${challenge.title}
                        </h2>
                        <div style="width: 80px;"></div>
                    </div>
                    
                    <div class="blog-content" style="color: #ffffff; line-height: 1.7; font-size: 15px; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px;">
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #00ff41; margin-bottom: 10px; font-size: 16px;">üìã OBJECTIVE</h3>
                            <p style="color: #e8e8e8;">${formatText(challenge.objective)}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #00ff41; margin-bottom: 10px; font-size: 16px;">üé≠ TONE & STYLE</h3>
                            <div style="color: #e8e8e8;">${formatText(challenge.tone)}</div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #00ff41; margin-bottom: 10px; font-size: 16px;">üí° EXAMPLES</h3>
                            <div style="color: #e8e8e8;">${formatText(challenge.examples)}</div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #00ff41; margin-bottom: 10px; font-size: 16px;">üì¶ DELIVERABLES</h3>
                            <div style="color: #e8e8e8;">${formatText(challenge.deliverables)}</div>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #ff6b6b; margin-bottom: 10px; font-size: 16px;">‚è∞ DEADLINE</h3>
                            <div style="color: #e8e8e8;">${formatText(challenge.deadline)}</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; border-top: 1px solid #404040; padding-top: 20px; margin-top: 20px;">
                        <button class="pixel-button" onclick="acceptChallenge('${challengeType}')" 
                                style="background: var(--ralph-pink); color: white; padding: 15px 30px; font-size: 16px; font-weight: bold;">
                            üöÄ ACCEPT CHALLENGE
                        </button>
                    </div>
                </div>
            `;
        }

        function acceptChallenge(challengeType) {
            const challengeNames = {
                creative: 'Creative Challenge',
                social: 'Social Challenge', 
                newBusiness: 'New Business Challenge'
            };
            
            showNotification(`${challengeNames[challengeType]} Accepted! üéâ`);
        }

        // Share Challenge Popup Functions
        let shareState = {
            completedShares: new Set(),
            totalItems: 0
        };

        function openSharePopup() {
            console.log('üì≤ Opening share challenge popup...');
            
            if (!AppState.config || !AppState.config.modules.sharing) {
                console.error('Share challenge configuration not found');
                return;
            }
            
            const shareConfig = AppState.config.modules.sharing.content;
            
            // Update popup content
            document.getElementById('shareWeek').textContent = shareConfig.weekOf;
            document.getElementById('giftCardAmount').textContent = shareConfig.giftCardAmount;
            
            // Populate share items
            populateShareItems(shareConfig.items);
            
            // Show popup
            document.getElementById('sharePopup').style.display = 'flex';
            
            // Reset state
            shareState.completedShares.clear();
            shareState.totalItems = shareConfig.items.length;
            updateShareProgress();
        }

        function populateShareItems(items) {
            const container = document.getElementById('shareItems');
            container.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'share-item';
                itemElement.id = `share-item-${item.id}`;
                
                itemElement.innerHTML = `
                    <img src="${item.thumbnail}" alt="${item.title}" class="share-thumbnail" 
                         onerror="this.style.background='linear-gradient(45deg, var(--ralph-pink), #ff1493)'; this.alt='${item.type}';">
                    <div class="share-content">
                        <div class="share-type">${item.type} ‚Ä¢ ${item.platform}</div>
                        <h4>${item.title}</h4>
                        <div class="share-description">${item.description}</div>
                        <div class="share-actions">
                            <button class="share-link-btn" onclick="openShareLink('${item.shareUrl}')">
                                üîó Open ${item.platform}
                            </button>
                            <div class="share-checkbox">
                                <input type="checkbox" id="checkbox-${item.id}" onchange="toggleShare(${item.id})">
                                <label for="checkbox-${item.id}">Shared!</label>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        function openShareLink(url) {
            window.open(url, '_blank');
        }

        function toggleShare(itemId) {
            const checkbox = document.getElementById(`checkbox-${itemId}`);
            const itemElement = document.getElementById(`share-item-${itemId}`);
            
            if (checkbox.checked) {
                shareState.completedShares.add(itemId);
                itemElement.classList.add('completed');
            } else {
                shareState.completedShares.delete(itemId);
                itemElement.classList.remove('completed');
            }
            
            updateShareProgress();
        }

        function updateShareProgress() {
            const completed = shareState.completedShares.size;
            const total = shareState.totalItems;
            
            document.getElementById('shareProgress').textContent = `${completed} of ${total} shared`;
            
            const submitBtn = document.getElementById('shareSubmitBtn');
            if (completed === total && total > 0) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üéØ ENTER SWEEPSTAKES';
            } else {
                submitBtn.disabled = true;
                submitBtn.textContent = `üéØ SHARE ${total - completed} MORE`;
            }
        }

        function submitShares() {
            if (shareState.completedShares.size !== shareState.totalItems) {
                return;
            }
            
            // Hide the form and show success message
            document.getElementById('shareFooter').style.display = 'none';
            document.getElementById('shareItems').style.display = 'none';
            document.getElementById('shareSuccess').style.display = 'block';
            
            // Add some celebration
            showNotification('üéâ Thanks for sharing! You\'ve been entered to win!');
            
            // Optional: Send data to server for tracking
            console.log('üìä User completed all shares:', Array.from(shareState.completedShares));
        }

        function closeSharePopup() {
            document.getElementById('sharePopup').style.display = 'none';
            
            // Reset popup state for next time
            setTimeout(() => {
                document.getElementById('shareFooter').style.display = 'block';
                document.getElementById('shareItems').style.display = 'block';
                document.getElementById('shareSuccess').style.display = 'none';
                shareState.completedShares.clear();
                // Uncheck all checkboxes
                document.querySelectorAll('.share-checkbox input').forEach(cb => cb.checked = false);
                // Remove completed styling
                document.querySelectorAll('.share-item').forEach(item => item.classList.remove('completed'));
            }, 300);
        }

        // Auto-show popup on desktop load (can be disabled/modified)
        function maybeShowSharePopup() {
            // Only show if sharing module is enabled
            if (AppState.config && AppState.config.modules.sharing && AppState.config.modules.sharing.enabled) {
                // Check if user has seen it this week (localStorage)
                const currentWeek = AppState.config.modules.sharing.content.weekOf;
                const lastSeenWeek = localStorage.getItem('sharePopupLastSeen');
                
                if (lastSeenWeek !== currentWeek) {
                    // Show popup after a short delay
                    setTimeout(() => {
                        openSharePopup();
                        localStorage.setItem('sharePopupLastSeen', currentWeek);
                    }, 3000); // Show after 3 seconds
                }
            }
        }

        function refreshAllModules() {
            if (!AppState.apiIntegration || !AppState.config) return;
            
            Object.entries(AppState.config.modules).forEach(([moduleId, moduleConfig]) => {
                if (moduleConfig.enabled && moduleConfig.apiEndpoint) {
                    AppState.apiIntegration.updateModuleContent(moduleId, moduleConfig);
                    AppState.apiIntegration.startAutoRefresh(moduleId, moduleConfig);
                }
            });
        }

        // Load desktop icons dynamically from CMS configuration
        function loadDesktopIcons() {
            console.log('üñ•Ô∏è Loading desktop icons from configuration...');
            
            const container = document.getElementById('desktop-icons');
            if (!container) {
                console.error('Desktop icons container not found');
                return;
            }
            
            if (!AppState.config || !AppState.config.modules) {
                console.error('Configuration or modules not available');
                return;
            }
            
            // Keep admin icon but clear other icons
            const adminIcon = container.querySelector('[onclick="openAdminLogin()"]');
            container.innerHTML = '';
            
            // Add module icons from configuration
            Object.entries(AppState.config.modules).forEach(([moduleId, moduleConfig]) => {
                if (moduleConfig.enabled) {
                    const iconElement = document.createElement('div');
                    iconElement.className = 'icon';
                    iconElement.onclick = () => openWindow(moduleId);
                    
                    // Create a simplified label (remove extra words)
                    let label = moduleConfig.title || moduleId; // Fallback to moduleId if no title
                    if (typeof label === 'string') {
                        label = label.replace(/v\d+\.\d+/g, ''); // Remove version numbers
                        label = label.replace(/\s+/g, ' ').trim(); // Clean up spaces
                    }
                    
                    // Use the exact title from CMS - no more hardcoded overrides
                    
                    iconElement.innerHTML = `
                        <div class="icon-image">${moduleConfig.icon}</div>
                        <div class="icon-label">${label}</div>
                    `;
                    
                    container.appendChild(iconElement);
                }
            });
            
            // Re-add admin icon at the end
            if (adminIcon) {
                container.appendChild(adminIcon);
            }
            
            console.log(`‚úÖ Loaded ${Object.keys(AppState.config.modules).filter(id => AppState.config.modules[id].enabled).length} desktop icons`);
        }

        // Bring window to front by managing z-index
        function bringToFront(windowElement) {
            // Get all windows (both static and iframe)
            const allWindows = document.querySelectorAll('.window');
            
            // Reset all windows to base z-index
            allWindows.forEach(win => {
                if (win.style.zIndex > 1000) {
                    win.style.zIndex = 1000;
                }
            });
            
            // Bring clicked window to front
            windowElement.style.zIndex = 1001;
        }

        // Create iframe window within desktop
        function openIframeWindow(url, title, width = 800, height = 600) {
            console.log('üåê Opening iframe window:', title, url);
            
            // Generate unique window ID
            const windowId = 'iframe_' + Date.now();
            
            // Use fixed position for now to debug
            const left = 100;
            const top = 100;
            
            console.log('üéØ Window positioning:', { left, top, width, height });
            
            // Create window element
            const windowElement = document.createElement('div');
            windowElement.id = windowId;
            windowElement.className = 'window';
            windowElement.style.cssText = `
                position: absolute;
                top: ${top}px;
                left: ${left}px;
                width: ${width}px;
                height: ${height}px;
                z-index: 1000;
                background: #c0c0c0;
                border: 2px outset #c0c0c0;
                box-shadow: 2px 2px 0px #808080;
                display: block !important;
            `;
            
            // Create window HTML with iframe
            windowElement.innerHTML = `
                <div class="window-header">
                    <div class="window-title">üåê ${title}</div>
                    <div class="window-controls">
                        <button class="window-button" onclick="minimizeWindow('${windowId}')">_</button>
                        <button class="window-button" onclick="maximizeWindow('${windowId}')">‚ñ°</button>
                        <button class="window-button" onclick="closeIframeWindow('${windowId}')">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 0; overflow: hidden;">
                    <iframe 
                        src="${url}" 
                        style="width: 100%; height: 100%; border: none; background: white;"
                        frameborder="0"
                        allowfullscreen>
                    </iframe>
                </div>
            `;
            
            // Add to desktop
            document.body.appendChild(windowElement);
            
            console.log('üîç Element added to DOM:', {
                elementId: windowId,
                elementExists: !!document.getElementById(windowId),
                elementVisible: windowElement.offsetWidth > 0 && windowElement.offsetHeight > 0,
                computedStyle: window.getComputedStyle(windowElement).display,
                boundingRect: windowElement.getBoundingClientRect()
            });
            
            // Make draggable
            makeDraggable(windowElement);
            
            // Add click handler to bring to front
            windowElement.addEventListener('mousedown', () => {
                bringToFront(windowElement);
            });
            
            // Focus the window
            bringToFront(windowElement);
            
            console.log('‚úÖ Iframe window created:', windowId);
            return windowId;
        }

        // Close iframe window
        function closeIframeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.remove();
                console.log('üóëÔ∏è Iframe window closed:', windowId);
            }
        }

        // Admin login functionality
        function openAdminLogin() {
            openWindow('adminLogin');
            // Focus on username field
            setTimeout(() => {
                document.getElementById('adminUsername').focus();
            }, 100);
        }

        // Admin credentials (in production, this would be server-side)
        const ADMIN_CREDS = {
            username: 'ralph',
            password: 'admin123'
        };

        // Handle admin login form
        document.addEventListener('DOMContentLoaded', () => {
            const adminForm = document.getElementById('adminLoginForm');
            if (adminForm) {
                adminForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('adminUsername').value;
                    const password = document.getElementById('adminPassword').value;
                    
                    try {
                        const response = await fetch('/api/admin-auth', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ username, password })
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Success - redirect to admin panel with session
                            showNotification('Access granted! Opening CMS...');
                            setTimeout(() => {
                                window.open(`/admin/${result.sessionId}`, '_blank');
                                closeWindow('adminLogin');
                                // Reset the form to default values
                                document.getElementById('adminUsername').value = 'ralph';
                                document.getElementById('adminPassword').value = 'admin123';
                            }, 1500);
                        } else {
                            throw new Error('Authentication failed');
                        }
                    } catch (error) {
                        // Show error
                        const errorDiv = document.getElementById('adminLoginError');
                        errorDiv.style.display = 'block';
                        
                        // Clear error after 3 seconds
                        setTimeout(() => {
                            errorDiv.style.display = 'none';
                        }, 3000);
                        
                        // Clear password field
                        document.getElementById('adminPassword').value = '';
                    }
                });
                
                // Enter key support for password field
                document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        adminForm.dispatchEvent(new Event('submit'));
                    }
                });
            }
        });

        // Form submission handler
        async function submitSuggestion() {
            const nameInput = document.querySelector('#suggestions input[type="text"]');
            const ideaInput = document.querySelector('#suggestions textarea');
            
            if (!nameInput || !ideaInput) return;
            
            const data = {
                name: nameInput.value.trim(),
                idea: ideaInput.value.trim(),
                timestamp: new Date().toISOString()
            };
            
            if (!data.name || !data.idea) {
                showNotification('Please fill in all fields!');
                return;
            }
            
            if (AppState.config?.modules?.suggestions?.submitEndpoint) {
                const result = await AppState.apiIntegration.submitData(
                    AppState.config.modules.suggestions.submitEndpoint,
                    data
                );
                
                if (result.success) {
                    nameInput.value = '';
                    ideaInput.value = '';
                    showNotification('Suggestion submitted successfully!');
                } else {
                    showNotification('Failed to submit suggestion. Please try again.');
                }
            } else {
                // Simulate success if no API endpoint
                nameInput.value = '';
                ideaInput.value = '';
                showNotification('Suggestion submitted!');
            }
        }
        
        // Responsive handling
        function handleResize() {
            const wasMobile = AppState.isMobile;
            AppState.isMobile = Utils.isMobileDevice();
            
            if (wasMobile !== AppState.isMobile) {
                // Reset window positions when switching between mobile and desktop
                document.querySelectorAll('.window').forEach(windowEl => {
                    if (AppState.isMobile) {
                        windowEl.style.cssText = '';
                    } else {
                        windowEl.dataset.maximized = 'false';
                    }
                });
            }
        }
        
        // Random character animation for ASCII art
        function randomAnimateAscii(element, duration = 2000) {
            if (!element) {
                console.error('‚ùå Random animation: element not found');
                return;
            }
            
            const originalText = element.textContent;
            const chars = [];
            
            // Wrap each character in a span with class for animation
            let wrappedText = '';
            for (let i = 0; i < originalText.length; i++) {
                const char = originalText[i];
                if (char === '\n') {
                    wrappedText += '\n';
                } else if (char === ' ') {
                    wrappedText += ' '; // Keep spaces as-is
                } else {
                    chars.push(i);
                    wrappedText += `<span class="ascii-char" data-index="${i}">${char}</span>`;
                }
            }
            
            element.innerHTML = wrappedText;
            
            // Shuffle the character indices for random order
            const shuffledChars = [...chars].sort(() => Math.random() - 0.5);
            
            // Calculate timing for animation
            const delayBetweenChars = duration / shuffledChars.length;
            
            console.log(`üé≤ Starting random ASCII animation:`, {
                element: element.className,
                totalChars: chars.length,
                duration: duration + 'ms',
                delayPerChar: delayBetweenChars.toFixed(2) + 'ms'
            });
            
            // Animate characters in random order
            shuffledChars.forEach((charIndex, animationIndex) => {
                setTimeout(() => {
                    const charSpan = element.querySelector(`[data-index="${charIndex}"]`);
                    if (charSpan) {
                        charSpan.classList.add('visible');
                    }
                    
                    // Log completion
                    if (animationIndex === shuffledChars.length - 1) {
                        console.log('‚úÖ Random ASCII animation complete for', element.className);
                    }
                }, animationIndex * delayBetweenChars);
            });
        }
        
        // Start boot ASCII random animation
        function startBootAsciiAnimation() {
            const bootLogo = document.querySelector('.boot-logo');
            if (!bootLogo) return;
            
            // Start animation immediately with 1.5 second duration
            randomAnimateAscii(bootLogo, 1500);
        }
        
        // Start desktop ASCII random animation
        function startDesktopAsciiAnimation() {
            const desktopAscii = document.querySelector('.desktop-ascii');
            if (!desktopAscii) return;
            
            // Start animation with 2 second duration
            setTimeout(() => {
                desktopAscii.classList.add('animating');
                randomAnimateAscii(desktopAscii, 2000);
            }, 1000); // Small delay to let boot complete first
        }

        // Boot sequence
        function bootSequence() {
            const bootScreen = document.getElementById('bootScreen');
            const desktop = document.getElementById('desktop');
            const loadingBar = document.getElementById('loadingBar');
            const loadingPercentage = document.getElementById('loadingPercentage');
            const bootMessages = document.getElementById('bootMessages');
            
            if (!bootScreen || !desktop) return;
            
            
            
            const messages = [
                'Loading system kernel...',
                'Initializing RALPH protocols...',
                'Checking security clearance...',
                'Loading user preferences...',
                'Mounting network drives...',
                'Starting creative services...',
                'Loading project database...',
                'Initializing communication modules...',
                'Checking for updates...',
                'Loading desktop environment...',
                'Starting RALPH SUPER-INTRANET...',
                'System ready!'
            ];
            
            let progress = 0;
            let messageIndex = 0;
            
            let bootInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                if (loadingBar) loadingBar.style.width = progress + '%';
                if (loadingPercentage) loadingPercentage.textContent = Math.floor(progress) + '%';
                
                if (bootMessages && messageIndex < messages.length && 
                    progress > (messageIndex / messages.length) * 100) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'boot-message';
                    messageDiv.textContent = '> ' + messages[messageIndex];
                    bootMessages.appendChild(messageDiv);
                    bootMessages.scrollTop = bootMessages.scrollHeight;
                    messageIndex++;
                }
                
                if (progress >= 100) {
                    clearInterval(bootInterval);
                    setTimeout(() => {
                        bootScreen.classList.add('hide');
                        desktop.style.display = 'block';
                        
                        // Start desktop ASCII random animation
                        startDesktopAsciiAnimation();
                        
                        
                        // Make chatbot window draggable
                        const chatbotWindow = document.getElementById('chatbot');
                        if (chatbotWindow && !AppState.isMobile) {
                            makeDraggable(chatbotWindow);
                        }
                        
                        setTimeout(() => {
                            showNotification('RALPH INTRANET SYSTEM 1.0 - READY');
                        }, 500);
                        
                        // Show welcome banner after 3 seconds
                        setTimeout(() => {
                            showWelcomeBanner();
                        }, 3000);
                    }, 1000);
                }
            }, 300);
        }
        
        // Welcome Banner Functions
        function showWelcomeBanner() {
            const banner = document.getElementById('welcomeBanner');
            if (banner) {
                banner.classList.add('show');
            }
        }
        
        function closeBanner() {
            const banner = document.getElementById('welcomeBanner');
            if (banner) {
                banner.classList.remove('show');
            }
        }
        
        // Music Player Functionality
        let musicPlayer = {
            audio: null,
            isPlaying: false,
            currentTrack: 0,
            volume: 0.7,
            playlist: [] // Will be loaded from CMS config
        };
        
        function toggleMusicPlayer() {
            const player = document.getElementById('musicPlayer');
            const button = document.querySelector('.sound-button');
            
            if (player.classList.contains('active')) {
                player.classList.remove('active');
                button.classList.remove('active');
            } else {
                player.classList.add('active');
                button.classList.add('active');
                initializeMusicPlayer();
                
                // Make draggable if not already
                if (!player.draggableInitialized && !AppState.isMobile) {
                    makeMusicPlayerDraggable(player);
                    player.draggableInitialized = true;
                }
            }
        }
        
        function initializeMusicPlayer() {
            // Load playlist from CMS config if not already loaded
            if (musicPlayer.playlist.length === 0 && AppState.config && AppState.config.modules && AppState.config.modules.music) {
                const musicModule = AppState.config.modules.music;
                if (musicModule.content && musicModule.content.tracks) {
                    musicPlayer.playlist = musicModule.content.tracks.map(track => ({
                        title: track.title,
                        artist: track.artist,
                        file: track.file
                    }));
                }
            }
            
            if (!musicPlayer.audio) {
                musicPlayer.audio = new Audio();
                musicPlayer.audio.volume = musicPlayer.volume;
                
                musicPlayer.audio.addEventListener('timeupdate', updateTrackTime);
                musicPlayer.audio.addEventListener('ended', nextTrack);
                musicPlayer.audio.addEventListener('loadstart', () => {
                    document.getElementById('trackInfo').textContent = 'Loading...';
                });
                musicPlayer.audio.addEventListener('canplay', () => {
                    const track = musicPlayer.playlist[musicPlayer.currentTrack];
                    if (track) {
                        document.getElementById('trackInfo').textContent = `${track.artist} - ${track.title}`;
                    }
                });
                musicPlayer.audio.addEventListener('error', () => {
                    document.getElementById('trackInfo').textContent = 'Error loading track';
                });
                
                loadCurrentTrack();
            }
        }
        
        function loadCurrentTrack() {
            if (musicPlayer.playlist.length > 0 && musicPlayer.currentTrack < musicPlayer.playlist.length) {
                const track = musicPlayer.playlist[musicPlayer.currentTrack];
                musicPlayer.audio.src = track.file;
                document.getElementById('trackInfo').textContent = `${track.artist} - ${track.title}`;
                document.getElementById('trackTime').textContent = '00:00 / 00:00';
            }
        }
        
        function togglePlayPause() {
            if (!musicPlayer.audio) {
                initializeMusicPlayer();
                return;
            }
            
            const playBtn = document.getElementById('playBtn');
            
            if (musicPlayer.isPlaying) {
                musicPlayer.audio.pause();
                playBtn.textContent = '‚ñ∂';
                musicPlayer.isPlaying = false;
            } else {
                musicPlayer.audio.play().then(() => {
                    playBtn.textContent = '‚è∏';
                    musicPlayer.isPlaying = true;
                }).catch(() => {
                    showNotification('Error playing audio - check file path');
                });
            }
        }
        
        function stopTrack() {
            if (musicPlayer.audio) {
                musicPlayer.audio.pause();
                musicPlayer.audio.currentTime = 0;
                document.getElementById('playBtn').textContent = '‚ñ∂';
                musicPlayer.isPlaying = false;
                updateTrackTime();
            }
        }
        
        function previousTrack() {
            if (musicPlayer.playlist.length > 0) {
                musicPlayer.currentTrack = (musicPlayer.currentTrack - 1 + musicPlayer.playlist.length) % musicPlayer.playlist.length;
                loadCurrentTrack();
                if (musicPlayer.isPlaying) {
                    togglePlayPause();
                    setTimeout(togglePlayPause, 100);
                }
            }
        }
        
        function nextTrack() {
            if (musicPlayer.playlist.length > 0) {
                musicPlayer.currentTrack = (musicPlayer.currentTrack + 1) % musicPlayer.playlist.length;
                loadCurrentTrack();
                if (musicPlayer.isPlaying) {
                    togglePlayPause();
                    setTimeout(togglePlayPause, 100);
                }
            }
        }
        
        function updateTrackTime() {
            if (musicPlayer.audio) {
                const current = formatTime(musicPlayer.audio.currentTime || 0);
                const duration = formatTime(musicPlayer.audio.duration || 0);
                document.getElementById('trackTime').textContent = `${current} / ${duration}`;
                
                // Update progress bar if exists
                const progressBar = document.querySelector('.track-progress');
                if (progressBar && musicPlayer.audio.duration) {
                    const progress = (musicPlayer.audio.currentTime / musicPlayer.audio.duration) * 100;
                    progressBar.style.width = progress + '%';
                }
            }
        }
        
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function setVolume(value) {
            musicPlayer.volume = value / 100;
            if (musicPlayer.audio) {
                musicPlayer.audio.volume = musicPlayer.volume;
            }
            // Update slider visual if needed
            const slider = document.getElementById('volumeSlider');
            if (slider && typeof value === 'number') {
                slider.value = value;
            }
        }
        
        function makeMusicPlayerDraggable(element) {
            if (AppState.isMobile) return; // Disable dragging on mobile
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            const header = element.querySelector('.player-header');
            if (!header) return;
            
            const dragMouseDown = (e) => {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            };
            
            const elementDrag = (e) => {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                let newTop = element.offsetTop - pos2;
                let newLeft = element.offsetLeft - pos1;
                
                // Keep within viewport bounds
                const rect = element.getBoundingClientRect();
                const maxTop = window.innerHeight - rect.height - 40;
                const maxLeft = window.innerWidth - rect.width;
                
                newTop = Math.max(0, Math.min(newTop, maxTop));
                newLeft = Math.max(0, Math.min(newLeft, maxLeft));
                
                element.style.top = newTop + "px";
                element.style.left = newLeft + "px";
                element.style.right = "auto"; // Override right positioning
                element.style.bottom = "auto"; // Override bottom positioning
            };
            
            const closeDragElement = () => {
                document.onmouseup = null;
                document.onmousemove = null;
            };
            
            header.onmousedown = dragMouseDown;
            header.style.cursor = 'move';
        }
        
        // Initialize application
        async function init() {
            // Detect device type
            AppState.isMobile = Utils.isMobileDevice();
            AppState.touchDevice = 'ontouchstart' in window;
            
            // Enable audio on first user interaction
            document.addEventListener('click', initAudio, { once: true });
            document.addEventListener('keydown', initAudio, { once: true });
            document.addEventListener('touchstart', initAudio, { once: true });
            
            // Load CMS configuration
            if (typeof CMS_CONFIG !== 'undefined') {
                AppState.config = CMS_CONFIG;
                
                // Initialize API integration
                if (typeof APIIntegration !== 'undefined') {
                    AppState.apiIntegration = new APIIntegration(AppState.config);
                }
                
                // Chatbot is now handled server-side for security
                console.log('üí¨ Chatbot configured - using secure server endpoint');
                
                // Load desktop icons from CMS configuration
                loadDesktopIcons();
                
                // Maybe show share popup after boot
                setTimeout(() => maybeShowSharePopup(), 5000);
            }
            
            // Start boot sequence
            bootSequence();
            
            // Start clock with tracked interval
            const clockInterval = setInterval(updateClock, 1000);
            AppState.intervals.push(clockInterval);
            updateClock();
            
            // Handle responsive design
            window.addEventListener('resize', Utils.debounce(handleResize, 250));
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.window.active').forEach(w => {
                        w.classList.remove('active');
                    });
                }
            });
            
            // Chat input handler
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendChat();
                    }
                });
            }
            
            // Prevent zoom on double tap for mobile
            if (AppState.touchDevice) {
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
            
            // Start auto-refresh for modules with API endpoints
            setTimeout(() => {
                // Initial config refresh after page load
                refreshConfigFromServer();
            }, 2000); // Delay to ensure all elements are loaded
        }
        
        // Refresh configuration from server
        async function refreshConfigFromServer() {
            console.log('üîÑ CHECKING FOR CONFIG UPDATES FROM SERVER');
            try {
                const response = await fetch(`/api/get-config?t=${Date.now()}`);
                console.log('üì° Config fetch response status:', response.status);
                
                if (response.ok) {
                    const newConfig = await response.json();
                    console.log('üì• New config received, modules:', Object.keys(newConfig.modules || {}));
                    
                    // Check if config actually changed
                    const configChanged = JSON.stringify(newConfig) !== JSON.stringify(AppState.config);
                    console.log('üîç Config changed?', configChanged);
                    
                    if (configChanged) {
                        console.log('üöÄ APPLYING CONFIG CHANGES TO FRONTEND');
                        AppState.config = newConfig;
                        
                        // Update global reference
                        window.CMS_CONFIG = newConfig;
                        
                        // Reload content with new configuration
                        console.log('üîÑ Reloading content from CMS...');
                        loadDesktopIcons();
                        
                        console.log('‚úÖ Configuration refreshed and applied successfully!');
                        showNotification('‚ú® Content updated from CMS!');
                    } else {
                        console.log('üìã No changes detected in config');
                    }
                } else {
                    console.error('‚ùå Failed to fetch config from server, status:', response.status);
                }
            } catch (error) {
                console.error('üí• Error refreshing config:', error);
            }
        }
        
        // Periodically check for config updates (every 30 seconds for production)
        const configInterval = setInterval(refreshConfigFromServer, 30000);
        AppState.intervals.push(configInterval);
        
        // Cleanup function for when page unloads
        window.addEventListener('beforeunload', () => {
            // Clear all intervals
            AppState.intervals.forEach(id => clearInterval(id));
            // Clear all timeouts
            AppState.timeouts.forEach(id => clearTimeout(id));
            // Clear all animation frames
            AppState.rafIds.forEach(id => cancelAnimationFrame(id));
        });
        
        // Start application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>